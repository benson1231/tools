<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-12-26">

<title>fastp 基本使用</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="fastp_files/libs/clipboard/clipboard.min.js"></script>
<script src="fastp_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="fastp_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="fastp_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="fastp_files/libs/quarto-html/popper.min.js"></script>
<script src="fastp_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="fastp_files/libs/quarto-html/anchor.min.js"></script>
<link href="fastp_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="fastp_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="fastp_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="fastp_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="fastp_files/libs/bootstrap/bootstrap-91f297ac5b9b6094cb160b32f5ee6a0a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="../styles/quarto.css">
</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="1">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#fastp-介紹" id="toc-fastp-介紹" class="nav-link active" data-scroll-target="#fastp-介紹"><span class="header-section-number">1</span> fastp 介紹</a></li>
  <li><a href="#fastp--v-查看版本" id="toc-fastp--v-查看版本" class="nav-link" data-scroll-target="#fastp--v-查看版本"><span class="header-section-number">2</span> fastp -v (查看版本)</a></li>
  <li><a href="#fastp-執行" id="toc-fastp-執行" class="nav-link" data-scroll-target="#fastp-執行"><span class="header-section-number">3</span> fastp (執行)</a></li>
  <li><a href="#fastp-help" id="toc-fastp-help" class="nav-link" data-scroll-target="#fastp-help"><span class="header-section-number">4</span> fastp –help</a></li>
  <li><a href="#環境紀錄" id="toc-環境紀錄" class="nav-link" data-scroll-target="#環境紀錄"><span class="header-section-number">5</span> 環境紀錄</a></li>
  </ul>
<div class="quarto-other-links"><h2>Other Links</h2><ul><li><a href="https://benson1231.github.io/tools/"><i class="bi bi-house"></i>home</a></li></ul></div><div class="quarto-code-links"><h2>Code Links</h2><ul><li><a href="https://github.com/benson1231/tools"><i class="bi bi-github"></i>github</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">fastp 基本使用</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025-12-26</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="fastp-介紹" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> fastp 介紹</h1>
<blockquote class="blockquote">
<p>fastp 是目前業界（以及 nf-core、GATK Best Practices）中最常見的測序前處理工具之一。 fastp 主要針對 Illumina / MGI <code>short reads</code>，若是 Nanopore/PacBio <code>long reads</code> 請使用 <a href="https://github.com/OpenGene/fastplong">fastplong</a></p>
</blockquote>
<p><a href="https://github.com/OpenGene/fastp">fastp</a> 是一款快速、全方位的序列品質控制（Quality Control, QC）與前處理（preprocessing）工具，由 <a href="https://academic.oup.com/bioinformatics/article/34/17/i884/5093234?login=false">Chen, Shifu et al.&nbsp;(2018)</a> 開發。它整合了傳統流程中常見的 FastQC、Trimmomatic 與 Cutadapt 等功能，提供速度快、功能完整、易於使用的測序資料預處理解決方案。</p>
<blockquote class="blockquote">
<p>Shifu Chen. fastp 1.0: An ultra-fast all-round tool for FASTQ data quality control and preprocessing. iMeta 4.5 (2025): e70078</p>
</blockquote>
<p>fastp 以 <strong>C++ 實作並支援多線程運算</strong>，能在極短時間內完成 Illumina 測序資料的多項處理，包含：</p>
<ul>
<li><strong>品質修剪（quality trimming）</strong>：自動根據 per-base quality 進行 trimming 或低品質讀段移除。</li>
<li><strong>自動偵測與移除 adapters</strong>：不需額外提供 adapter 序列，fastp 能從資料中推測並移除。</li>
<li><strong>低品質序列過濾</strong>：依據品質門檻、N 比例、最短長度等條件過濾 reads。</li>
<li><strong>polyG / polyX tail 移除</strong>：特別適用於 Illumina NovaSeq / NextSeq two-color chemistry 所造成的 polyG artifact。</li>
<li><strong>滑動窗口（sliding window）修剪與序列截斷</strong>：依平均品質移除尾端低品質區段。</li>
<li><strong>讀長過濾（length filtering）</strong>：移除過短的 reads 或指定長度閾值。</li>
</ul>
<p>此外，fastp 會輸出 <a href="http://opengene.org/fastp/fastp.html">HTML</a> 與 <a href="http://opengene.org/fastp/fastp.json">JSON</a> 格式的 QC 報告，內容包含：</p>
<ul>
<li>讀序品質分佈（Q20 / Q30）</li>
<li>GC 分佈與序列組成</li>
<li>duplication 分析</li>
<li>讀長分佈（read length distribution）</li>
<li>過濾與修剪統計（before/after filtering）</li>
<li>adapters 偵測與移除結果</li>
</ul>
<p>透過這些整合式功能，fastp 提供了速度快、資訊完整且操作直觀的測序預處理流程，使其成為現代生物資訊分析（包含 nf-core 與 GATK）中的標準 QC 工具之一。</p>
<hr>
</section>
<section id="fastp--v-查看版本" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> fastp -v (查看版本)</h1>
<p>使用 <code>-v</code> 參數確認是否成功安裝，並顯示版本號。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">fastp</span> <span class="at">-v</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>fastp 1.0.1</code></pre>
</div>
</div>
<hr>
</section>
<section id="fastp-執行" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> fastp (執行)</h1>
<p>以下示範如何以 <code>fastp</code> 對 <code>FASTQ 檔案</code> 進行 adapters 修剪、過濾與 QC，並輸出：</p>
<ul>
<li>修剪後的 FASTQ</li>
<li>HTML QC 報告</li>
<li>JSON QC 統計</li>
</ul>
<p>執行前請確認：</p>
<ul>
<li>測試 FASTQ 位於 <code>../.test/</code></li>
</ul>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">fastp</span> <span class="dt">\</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>-i ../.test/a.chr21_R1.fastq.gz <span class="dt">\</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>-I ../.test/a.chr21_R2.fastq.gz <span class="dt">\</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>-o results/a.chr21_R1.trimmed.fastq.gz <span class="dt">\</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>-O results/a.chr21_R2.trimmed.fastq.gz <span class="dt">\</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>--html fastp_report.html <span class="dt">\</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>--json fastp_report.json <span class="dt">\</span></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>--thread 4</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Read1 before filtering:
total reads: 4857
total bases: 353935
Q20 bases: 331626(93.6969%)
Q30 bases: 305684(86.3673%)
Q40 bases: 102509(28.9627%)

Read2 before filtering:
total reads: 4857
total bases: 346145
Q20 bases: 306292(88.4866%)
Q30 bases: 281516(81.3289%)
Q40 bases: 94336(27.2533%)

Read1 after filtering:
total reads: 4185
total bases: 305344
Q20 bases: 295293(96.7083%)
Q30 bases: 275876(90.3492%)
Q40 bases: 97465(31.9197%)

Read2 after filtering:
total reads: 4185
total bases: 304434
Q20 bases: 291349(95.7019%)
Q30 bases: 270189(88.7513%)
Q40 bases: 93042(30.5623%)

Filtering result:
reads passed filter: 8370
reads failed due to low quality: 1344
reads failed due to too many N: 0
reads failed due to too short: 0
reads with adapter trimmed: 82
bases trimmed due to adapters: 1549

Duplication rate: 1.62652%

Insert size peak (evaluated by paired-end reads): 34

JSON report: fastp_report.json
HTML report: fastp_report.html

fastp -i ../.test/a.chr21_R1.fastq.gz -I ../.test/a.chr21_R2.fastq.gz -o results/a.chr21_R1.trimmed.fastq.gz -O results/a.chr21_R2.trimmed.fastq.gz --html fastp_report.html --json fastp_report.json --thread 4 
fastp v1.0.1, time used: 2 seconds</code></pre>
</div>
</div>
<hr>
</section>
<section id="fastp-help" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> fastp –help</h1>
<p>顯示 fastp 提供的主要參數與使用說明，適合作為快速查詢指令用途。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">fastp</span> <span class="at">--help</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>usage: fastp [options] ... 
options:
  -i, --in1                            read1 input file name (string [=])
  -o, --out1                           read1 output file name (string [=])
  -I, --in2                            read2 input file name (string [=])
  -O, --out2                           read2 output file name (string [=])
      --unpaired1                      for PE input, if read1 passed QC but read2 not, it will be written to unpaired1. Default is to discard it. (string [=])
      --unpaired2                      for PE input, if read2 passed QC but read1 not, it will be written to unpaired2. If --unpaired2 is same as --unpaired1 (default mode), both unpaired reads will be written to this same file. (string [=])
      --overlapped_out                 for each read pair, output the overlapped region if it has no any mismatched base. (string [=])
      --failed_out                     specify the file to store reads that cannot pass the filters. (string [=])
  -m, --merge                          for paired-end input, merge each pair of reads into a single read if they are overlapped. The merged reads will be written to the file given by --merged_out, the unmerged reads will be written to the files specified by --out1 and --out2. The merging mode is disabled by default.
      --merged_out                     in the merging mode, specify the file name to store merged output, or specify --stdout to stream the merged output (string [=])
      --include_unmerged               in the merging mode, write the unmerged or unpaired reads to the file specified by --merge. Disabled by default.
  -6, --phred64                        indicate the input is using phred64 scoring (it'll be converted to phred33, so the output will still be phred33)
  -z, --compression                    compression level for gzip output (1 ~ 9). 1 is fastest, 9 is smallest, default is 4. (int [=4])
      --stdin                          input from STDIN. If the STDIN is interleaved paired-end FASTQ, please also add --interleaved_in.
      --stdout                         stream passing-filters reads to STDOUT. This option will result in interleaved FASTQ output for paired-end output. Disabled by default.
      --interleaved_in                 indicate that &lt;in1&gt; is an interleaved FASTQ which contains both read1 and read2. Disabled by default.
      --reads_to_process               specify how many reads/pairs to be processed. Default 0 means process all reads. (int [=0])
      --dont_overwrite                 don't overwrite existing files. Overwritting is allowed by default.
      --fix_mgi_id                     the MGI FASTQ ID format is not compatible with many BAM operation tools, enable this option to fix it.
  -V, --verbose                        output verbose log information (i.e. when every 1M reads are processed).
  -A, --disable_adapter_trimming       adapter trimming is enabled by default. If this option is specified, adapter trimming is disabled
  -a, --adapter_sequence               the adapter for read1. For SE data, if not specified, the adapter will be auto-detected. For PE data, this is used if R1/R2 are found not overlapped. (string [=auto])
      --adapter_sequence_r2            the adapter for read2 (PE data only). This is used if R1/R2 are found not overlapped. If not specified, it will be the same as &lt;adapter_sequence&gt; (string [=auto])
      --adapter_fasta                  specify a FASTA file to trim both read1 and read2 (if PE) by all the sequences in this FASTA file (string [=])
  -2, --detect_adapter_for_pe          enable adapter detection for PE data to get ultra-clean data. It takes more time to find just a little bit more adapters.
      --allow_gap_overlap_trimming     allow up to one gap when trim adapters by overlap analysis for PE data. By default no gap is allowed.
  -f, --trim_front1                    trimming how many bases in front for read1, default is 0 (int [=0])
  -t, --trim_tail1                     trimming how many bases in tail for read1, default is 0 (int [=0])
  -b, --max_len1                       if read1 is longer than max_len1, then trim read1 at its tail to make it as long as max_len1. Default 0 means no limitation (int [=0])
  -F, --trim_front2                    trimming how many bases in front for read2. If it's not specified, it will follow read1's settings (int [=0])
  -T, --trim_tail2                     trimming how many bases in tail for read2. If it's not specified, it will follow read1's settings (int [=0])
  -B, --max_len2                       if read2 is longer than max_len2, then trim read2 at its tail to make it as long as max_len2. Default 0 means no limitation. If it's not specified, it will follow read1's settings (int [=0])
  -D, --dedup                          enable deduplication to drop the duplicated reads/pairs
      --dup_calc_accuracy              accuracy level to calculate duplication (1~6), higher level uses more memory (1G, 2G, 4G, 8G, 16G, 24G). Default 1 for no-dedup mode, and 3 for dedup mode. (int [=0])
      --dont_eval_duplication          don't evaluate duplication rate to save time and use less memory.
  -g, --trim_poly_g                    force polyG tail trimming, by default trimming is automatically enabled for Illumina NextSeq/NovaSeq data
      --poly_g_min_len                 the minimum length to detect polyG in the read tail. 10 by default. (int [=10])
  -G, --disable_trim_poly_g            disable polyG tail trimming, by default trimming is automatically enabled for Illumina NextSeq/NovaSeq data
  -x, --trim_poly_x                    enable polyX trimming in 3' ends.
      --poly_x_min_len                 the minimum length to detect polyX in the read tail. 10 by default. (int [=10])
  -5, --cut_front                      move a sliding window from front (5') to tail, drop the bases in the window if its mean quality &lt; threshold, stop otherwise.
  -3, --cut_tail                       move a sliding window from tail (3') to front, drop the bases in the window if its mean quality &lt; threshold, stop otherwise.
  -r, --cut_right                      move a sliding window from front to tail, if meet one window with mean quality &lt; threshold, drop the bases in the window and the right part, and then stop.
  -W, --cut_window_size                the window size option shared by cut_front, cut_tail or cut_sliding. Range: 1~1000, default: 4 (int [=4])
  -M, --cut_mean_quality               the mean quality requirement option shared by cut_front, cut_tail or cut_sliding. Range: 1~36 default: 20 (Q20) (int [=20])
      --cut_front_window_size          the window size option of cut_front, default to cut_window_size if not specified (int [=4])
      --cut_front_mean_quality         the mean quality requirement option for cut_front, default to cut_mean_quality if not specified (int [=20])
      --cut_tail_window_size           the window size option of cut_tail, default to cut_window_size if not specified (int [=4])
      --cut_tail_mean_quality          the mean quality requirement option for cut_tail, default to cut_mean_quality if not specified (int [=20])
      --cut_right_window_size          the window size option of cut_right, default to cut_window_size if not specified (int [=4])
      --cut_right_mean_quality         the mean quality requirement option for cut_right, default to cut_mean_quality if not specified (int [=20])
  -Q, --disable_quality_filtering      quality filtering is enabled by default. If this option is specified, quality filtering is disabled
  -q, --qualified_quality_phred        the quality value that a base is qualified. Default 15 means phred quality &gt;=Q15 is qualified. (int [=15])
  -u, --unqualified_percent_limit      how many percents of bases are allowed to be unqualified (0~100). Default 40 means 40% (int [=40])
  -n, --n_base_limit                   if one read's number of N base is &gt;n_base_limit, then this read/pair is discarded. Default is 5 (int [=5])
  -e, --average_qual                   if one read's average quality score &lt;avg_qual, then this read/pair is discarded. Default 0 means no requirement (int [=0])
  -L, --disable_length_filtering       length filtering is enabled by default. If this option is specified, length filtering is disabled
  -l, --length_required                reads shorter than length_required will be discarded, default is 15. (int [=15])
      --length_limit                   reads longer than length_limit will be discarded, default 0 means no limitation. (int [=0])
  -y, --low_complexity_filter          enable low complexity filter. The complexity is defined as the percentage of base that is different from its next base (base[i] != base[i+1]).
  -Y, --complexity_threshold           the threshold for low complexity filter (0~100). Default is 30, which means 30% complexity is required. (int [=30])
      --filter_by_index1               specify a file contains a list of barcodes of index1 to be filtered out, one barcode per line (string [=])
      --filter_by_index2               specify a file contains a list of barcodes of index2 to be filtered out, one barcode per line (string [=])
      --filter_by_index_threshold      the allowed difference of index barcode for index filtering, default 0 means completely identical. (int [=0])
  -c, --correction                     enable base correction in overlapped regions (only for PE data), default is disabled
      --overlap_len_require            the minimum length to detect overlapped region of PE reads. This will affect overlap analysis based PE merge, adapter trimming and correction. 30 by default. (int [=30])
      --overlap_diff_limit             the maximum number of mismatched bases to detect overlapped region of PE reads. This will affect overlap analysis based PE merge, adapter trimming and correction. 5 by default. (int [=5])
      --overlap_diff_percent_limit     the maximum percentage of mismatched bases to detect overlapped region of PE reads. This will affect overlap analysis based PE merge, adapter trimming and correction. Default 20 means 20%. (int [=20])
  -U, --umi                            enable unique molecular identifier (UMI) preprocessing
      --umi_loc                        specify the location of UMI, can be (index1/index2/read1/read2/per_index/per_read, default is none (string [=])
      --umi_len                        if the UMI is in read1/read2, its length should be provided (int [=0])
      --umi_prefix                     if specified, an underline will be used to connect prefix and UMI (i.e. prefix=UMI, UMI=AATTCG, final=UMI_AATTCG). No prefix by default (string [=])
      --umi_skip                       if the UMI is in read1/read2, fastp can skip several bases following UMI, default is 0 (int [=0])
      --umi_delim                      delimiter to use between the read name and the UMI, default is : (string [=:])
  -p, --overrepresentation_analysis    enable overrepresented sequence analysis.
  -P, --overrepresentation_sampling    one in (--overrepresentation_sampling) reads will be computed for overrepresentation analysis (1~10000), smaller is slower, default is 20. (int [=20])
  -j, --json                           the json format report file name (string [=fastp.json])
  -h, --html                           the html format report file name (string [=fastp.html])
  -R, --report_title                   should be quoted with ' or ", default is "fastp report" (string [=fastp report])
  -w, --thread                         worker thread number, default is 3 (int [=3])
  -s, --split                          split output by limiting total split file number with this option (2~999), a sequential number prefix will be added to output name ( 0001.out.fq, 0002.out.fq...), disabled by default (int [=0])
  -S, --split_by_lines                 split output by limiting lines of each file with this option(&gt;=1000), a sequential number prefix will be added to output name ( 0001.out.fq, 0002.out.fq...), disabled by default (long [=0])
  -d, --split_prefix_digits            the digits for the sequential number padding (1~10), default is 4, so the filename will be padded as 0001.xxx, 0 to disable padding (int [=4])
      --cut_by_quality5                DEPRECATED, use --cut_front instead.
      --cut_by_quality3                DEPRECATED, use --cut_tail instead.
      --cut_by_quality_aggressive      DEPRECATED, use --cut_right instead.
      --discard_unmerged               DEPRECATED, no effect now, see the introduction for merging.
  -?, --help                           print this message</code></pre>
</div>
</div>
<hr>
</section>
<section id="環境紀錄" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> 環境紀錄</h1>
<p>完整記錄當前執行的 Conda 環境，有助於分析重現、版本追蹤與錯誤排查。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"======================================="</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Conda Environment: </span><span class="va">$(</span><span class="ex">mamba</span> env list <span class="kw">|</span> <span class="fu">grep</span> <span class="st">'*'</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'{print $1}'</span><span class="va">)</span><span class="st">"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"======================================="</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">mamba</span> list</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=======================================
Conda Environment: bio-tools
=======================================
List of packages in environment: "/home/benson/miniforge3/envs/bio-tools"

  Name                       Version            Build                 Channel    
───────────────────────────────────────────────────────────────────────────────────
  _libgcc_mutex              0.1                conda_forge           conda-forge
  _openmp_mutex              4.5                2_gnu                 conda-forge
  _python_abi3_support       1.0                hd8ed1ab_2            conda-forge
  _r-mutex                   1.0.1              anacondar_1           conda-forge
  alsa-lib                   1.2.15.1           hb03c661_0            conda-forge
  annotated-types            0.7.0              pyhd8ed1ab_1          conda-forge
  attrs                      25.4.0             pyhcf101f3_1          conda-forge
  backports.zstd             1.2.0              py314h680f03e_0       conda-forge
  bcftools                   1.23               h3a4d415_0            bioconda   
  bedtools                   2.31.1             h13024bc_3            bioconda   
  binutils_impl_linux-64     2.45               default_hfdba357_105  conda-forge
  brotli-python              1.2.0              py314h3de4e8d_1       conda-forge
  bwidget                    1.10.1             ha770c72_1            conda-forge
  bzip2                      1.0.8              hda65f42_8            conda-forge
  c-ares                     1.34.6             hb03c661_0            conda-forge
  ca-certificates            2025.11.12         hbd8a1cb_0            conda-forge
  cairo                      1.18.4             h3394656_0            conda-forge
  certifi                    2025.11.12         pyhd8ed1ab_0          conda-forge
  charset-normalizer         3.4.4              pyhd8ed1ab_0          conda-forge
  click                      8.3.1              pyh8f84b5b_1          conda-forge
  colorama                   0.4.6              pyhd8ed1ab_1          conda-forge
  coloredlogs                15.0.1             pyhd8ed1ab_4          conda-forge
  colormath                  3.0.0              pyhd8ed1ab_4          conda-forge
  cpython                    3.14.2             py314hd8ed1ab_100     conda-forge
  curl                       8.17.0             h4e3cde8_1            conda-forge
  dart-sass                  1.59.1             ha770c72_0            conda-forge
  deno                       2.3.1              hbf66b88_0            conda-forge
  deno-dom                   0.1.41             h4768de7_0            conda-forge
  esbuild                    0.27.2             hfc2019e_0            conda-forge
  expat                      2.7.3              hecca717_0            conda-forge
  fastp                      1.0.1              heae3180_0            bioconda   
  fastqc                     0.12.1             hdfd78af_0            bioconda   
  font-ttf-dejavu-sans-mono  2.37               hab24e00_0            conda-forge
  font-ttf-inconsolata       3.000              h77eed37_0            conda-forge
  font-ttf-source-code-pro   2.038              h77eed37_0            conda-forge
  font-ttf-ubuntu            0.83               h77eed37_3            conda-forge
  fontconfig                 2.15.0             h7e30c49_1            conda-forge
  fonts-conda-ecosystem      1                  0                     conda-forge
  fonts-conda-forge          1                  hc364b38_1            conda-forge
  freetype                   2.14.1             ha770c72_0            conda-forge
  fribidi                    1.0.16             hb03c661_0            conda-forge
  gcc_impl_linux-64          15.2.0             hc5723f1_16           conda-forge
  gfortran_impl_linux-64     15.2.0             h281d09f_16           conda-forge
  giflib                     5.2.2              hd590300_0            conda-forge
  graphite2                  1.3.14             hecca717_2            conda-forge
  gsl                        2.7                he838d99_0            conda-forge
  gxx_impl_linux-64          15.2.0             hda75c37_16           conda-forge
  h2                         4.3.0              pyhcf101f3_0          conda-forge
  harfbuzz                   11.0.0             h76408a6_0            conda-forge
  hpack                      4.1.0              pyhd8ed1ab_0          conda-forge
  htslib                     1.23               h566b1c6_0            bioconda   
  humanfriendly              10.0               pyh707e725_8          conda-forge
  humanize                   4.15.0             pyhd8ed1ab_0          conda-forge
  hyperframe                 6.1.0              pyhd8ed1ab_0          conda-forge
  icu                        75.1               he02047a_0            conda-forge
  idna                       3.11               pyhd8ed1ab_0          conda-forge
  importlib-metadata         8.7.0              pyhe01879c_1          conda-forge
  isa-l                      2.31.1             hb9d3cd8_1            conda-forge
  jinja2                     3.1.6              pyhcf101f3_1          conda-forge
  jsonschema                 4.25.1             pyhe01879c_0          conda-forge
  jsonschema-specifications  2025.9.1           pyhcf101f3_0          conda-forge
  kaleido-core               0.2.1              h3644ca4_0            conda-forge
  kernel-headers_linux-64    5.14.0             he073ed8_3            conda-forge
  keyutils                   1.6.3              hb9d3cd8_0            conda-forge
  krb5                       1.21.3             h659f571_0            conda-forge
  lcms2                      2.17               h717163a_0            conda-forge
  ld_impl_linux-64           2.45               default_hbd61a6d_105  conda-forge
  lerc                       4.0.0              h0aef613_1            conda-forge
  libblas                    3.11.0             5_h4a7cf45_openblas   conda-forge
  libcblas                   3.11.0             5_h0358290_openblas   conda-forge
  libcups                    2.3.3              hb8b1518_5            conda-forge
  libcurl                    8.17.0             h4e3cde8_1            conda-forge
  libdeflate                 1.22               hb9d3cd8_0            conda-forge
  libedit                    3.1.20250104       pl5321h7949ede_0      conda-forge
  libev                      4.33               hd590300_2            conda-forge
  libexpat                   2.7.3              hecca717_0            conda-forge
  libffi                     3.5.2              h9ec8514_0            conda-forge
  libfreetype                2.14.1             ha770c72_0            conda-forge
  libfreetype6               2.14.1             h73754d4_0            conda-forge
  libgcc                     15.2.0             he0feb66_16           conda-forge
  libgcc-devel_linux-64      15.2.0             hcc6f6b0_116          conda-forge
  libgcc-ng                  15.2.0             h69a702a_16           conda-forge
  libgfortran                15.2.0             h69a702a_16           conda-forge
  libgfortran-ng             15.2.0             h69a702a_16           conda-forge
  libgfortran5               15.2.0             h68bc16d_16           conda-forge
  libglib                    2.84.0             h2ff4ddf_0            conda-forge
  libgomp                    15.2.0             he0feb66_16           conda-forge
  libiconv                   1.18               h3b78370_2            conda-forge
  libjpeg-turbo              3.1.2              hb03c661_0            conda-forge
  liblapack                  3.11.0             5_h47877c9_openblas   conda-forge
  liblzma                    5.8.1              hb9d3cd8_2            conda-forge
  libmpdec                   4.0.0              hb9d3cd8_0            conda-forge
  libnghttp2                 1.67.0             had1ee68_0            conda-forge
  libopenblas                0.3.30             pthreads_h94d23a6_4   conda-forge
  libpng                     1.6.53             h421ea60_0            conda-forge
  libsanitizer               15.2.0             h90f66d4_16           conda-forge
  libsqlite                  3.51.1             h0c1763c_1            conda-forge
  libssh2                    1.11.1             hcf80075_0            conda-forge
  libstdcxx                  15.2.0             h934c35e_16           conda-forge
  libstdcxx-devel_linux-64   15.2.0             hd446a21_116          conda-forge
  libstdcxx-ng               15.2.0             hdf11a46_16           conda-forge
  libtiff                    4.7.0              hc4654cb_2            conda-forge
  libuuid                    2.41.3             h5347b49_0            conda-forge
  libuv                      1.51.0             hb03c661_1            conda-forge
  libwebp-base               1.6.0              hd42ef1d_0            conda-forge
  libxcb                     1.17.0             h8a09558_0            conda-forge
  libxcrypt                  4.4.36             hd590300_1            conda-forge
  libzlib                    1.3.1              hb9d3cd8_2            conda-forge
  make                       4.4.1              hb9d3cd8_2            conda-forge
  markdown                   3.10               pyhcf101f3_1          conda-forge
  markdown-it-py             4.0.0              pyhd8ed1ab_0          conda-forge
  markupsafe                 3.0.3              pyh7db6752_0          conda-forge
  mathjax                    2.7.7              ha770c72_3            conda-forge
  mdurl                      0.1.2              pyhd8ed1ab_1          conda-forge
  multiqc                    1.33               pyhdfd78af_0          bioconda   
  narwhals                   2.14.0             pyhcf101f3_0          conda-forge
  natsort                    8.4.0              pyh29332c3_1          conda-forge
  ncurses                    6.5                h2d0b736_3            conda-forge
  networkx                   3.6.1              pyhcf101f3_0          conda-forge
  nodejs                     22.21.1            h4a9c4b4_0            conda-forge
  nspr                       4.38               h29cc59b_0            conda-forge
  nss                        3.118              h445c969_0            conda-forge
  numpy                      2.4.0              py314h2b28147_0       conda-forge
  openjdk                    23.0.2             h53dfc1b_2            conda-forge
  openjpeg                   2.5.3              h55fea9a_1            conda-forge
  openssl                    3.6.0              h26f9b46_0            conda-forge
  packaging                  25.0               pyh29332c3_1          conda-forge
  pandoc                     3.6.3              ha770c72_0            conda-forge
  pango                      1.56.3             h9ac818e_1            conda-forge
  pcre2                      10.44              hc749103_2            conda-forge
  perl                       5.32.1             7_hd590300_perl5      conda-forge
  pillow                     11.3.0             py314hdf18abd_3       conda-forge
  pip                        25.3               pyh145f28c_0          conda-forge
  pixman                     0.46.4             h54a6638_1            conda-forge
  plotly                     6.5.0              pyhd8ed1ab_0          conda-forge
  polars                     1.36.1             pyh6a1acc5_0          conda-forge
  polars-lts-cpu             1.34.0.deprecated  hc364b38_0            conda-forge
  polars-runtime-32          1.36.1             py310hffdcd12_0       conda-forge
  polars-runtime-compat      1.36.1             py310hbcd5346_0       conda-forge
  pthread-stubs              0.4                hb9d3cd8_1002         conda-forge
  pyaml-env                  1.2.2              pyhd8ed1ab_0          conda-forge
  pydantic                   2.12.5             pyhcf101f3_1          conda-forge
  pydantic-core              2.41.5             py314h2e6c369_1       conda-forge
  pygments                   2.19.2             pyhd8ed1ab_0          conda-forge
  pysocks                    1.7.1              pyha55dd90_7          conda-forge
  python                     3.14.2             h32b2ec7_100_cp314    conda-forge
  python-dotenv              1.2.1              pyhcf101f3_0          conda-forge
  python-gil                 3.14.2             h4df99d1_100          conda-forge
  python-kaleido             0.2.1              pyhd8ed1ab_0          conda-forge
  python_abi                 3.14               8_cp314               conda-forge
  pyyaml                     6.0.3              pyh7db6752_0          conda-forge
  quarto                     1.8.26             hbf95b10_0            conda-forge
  r-base                     4.4.2              hbab086e_1            conda-forge
  r-base64enc                0.1_3              r44h54b55ab_1008      conda-forge
  r-bslib                    0.9.0              r44hc72bb7e_1         conda-forge
  r-cachem                   1.1.0              r44h54b55ab_2         conda-forge
  r-cli                      3.6.5              r44h3697838_1         conda-forge
  r-digest                   0.6.39             r44h3697838_0         conda-forge
  r-ellipsis                 0.3.2              r44h54b55ab_4         conda-forge
  r-evaluate                 1.0.5              r44hc72bb7e_1         conda-forge
  r-fastmap                  1.2.0              r44h3697838_2         conda-forge
  r-fontawesome              0.5.3              r44hc72bb7e_1         conda-forge
  r-fs                       1.6.6              r44h3697838_1         conda-forge
  r-glue                     1.8.0              r44h54b55ab_1         conda-forge
  r-here                     1.0.2              r44hc72bb7e_0         conda-forge
  r-highr                    0.11               r44hc72bb7e_2         conda-forge
  r-htmltools                0.5.9              r44h3697838_0         conda-forge
  r-jquerylib                0.1.4              r44hc72bb7e_4         conda-forge
  r-jsonlite                 2.0.0              r44h54b55ab_1         conda-forge
  r-knitr                    1.51               r44hc72bb7e_0         conda-forge
  r-lattice                  0.22_7             r44h54b55ab_1         conda-forge
  r-lifecycle                1.0.4              r44hc72bb7e_2         conda-forge
  r-matrix                   1.7_4              r44h0e4624f_1         conda-forge
  r-memoise                  2.0.1              r44hc72bb7e_4         conda-forge
  r-mime                     0.13               r44h54b55ab_1         conda-forge
  r-png                      0.1_8              r44h6b2d295_3         conda-forge
  r-r6                       2.6.1              r44hc72bb7e_1         conda-forge
  r-rappdirs                 0.3.3              r44h54b55ab_4         conda-forge
  r-rcpp                     1.1.0              r44h3697838_1         conda-forge
  r-rcpptoml                 0.2.3              r44h3697838_1         conda-forge
  r-reticulate               1.44.1             r44h3697838_0         conda-forge
  r-rlang                    1.1.6              r44h3697838_1         conda-forge
  r-rmarkdown                2.30               r44hc72bb7e_0         conda-forge
  r-rprojroot                2.1.1              r44hc72bb7e_1         conda-forge
  r-sass                     0.4.10             r44h3697838_1         conda-forge
  r-tinytex                  0.58               r44hc72bb7e_0         conda-forge
  r-withr                    3.0.2              r44hc72bb7e_1         conda-forge
  r-xfun                     0.55               r44h3697838_0         conda-forge
  r-yaml                     2.3.12             r44h54b55ab_0         conda-forge
  readline                   8.3                h853b02a_0            conda-forge
  referencing                0.37.0             pyhcf101f3_0          conda-forge
  regex                      2025.11.3          py314h5bd0f2a_1       conda-forge
  requests                   2.32.5             pyhd8ed1ab_0          conda-forge
  rich                       14.2.0             pyhcf101f3_0          conda-forge
  rich-click                 1.9.5              pyhd8ed1ab_0          conda-forge
  rpds-py                    0.30.0             py314h2e6c369_0       conda-forge
  samtools                   1.23               h96c455f_0            bioconda   
  sed                        4.9                h6688a6e_0            conda-forge
  seqtk                      1.5                h577a1d6_1            bioconda   
  spectra                    0.0.11             pyhd8ed1ab_2          conda-forge
  sqlite                     3.51.1             hbc0de68_1            conda-forge
  sysroot_linux-64           2.34               h087de78_3            conda-forge
  tiktoken                   0.12.0             py314h67fec18_3       conda-forge
  tk                         8.6.13             noxft_ha0e22de_103    conda-forge
  tktable                    2.10               h8d826fa_7            conda-forge
  tqdm                       4.67.1             pyhd8ed1ab_1          conda-forge
  typeguard                  4.4.4              pyhd8ed1ab_0          conda-forge
  typing-extensions          4.15.0             h396c80c_0            conda-forge
  typing-inspection          0.4.2              pyhd8ed1ab_1          conda-forge
  typing_extensions          4.15.0             pyhcf101f3_0          conda-forge
  typst                      0.13.0             h53e704d_0            conda-forge
  tzdata                     2025c              h8577fbf_0            conda-forge
  urllib3                    2.6.2              pyhd8ed1ab_0          conda-forge
  vcftools                   0.1.17             pl5321h077b44d_0      bioconda   
  xorg-libice                1.1.2              hb9d3cd8_0            conda-forge
  xorg-libsm                 1.2.6              he73a12e_0            conda-forge
  xorg-libx11                1.8.12             h4f16b4b_0            conda-forge
  xorg-libxau                1.0.12             hb03c661_1            conda-forge
  xorg-libxdmcp              1.1.5              hb03c661_1            conda-forge
  xorg-libxext               1.3.6              hb9d3cd8_0            conda-forge
  xorg-libxfixes             6.0.2              hb03c661_0            conda-forge
  xorg-libxi                 1.8.2              hb9d3cd8_0            conda-forge
  xorg-libxrandr             1.5.4              hb9d3cd8_0            conda-forge
  xorg-libxrender            0.9.12             hb9d3cd8_0            conda-forge
  xorg-libxt                 1.3.1              hb9d3cd8_0            conda-forge
  xorg-libxtst               1.2.5              hb9d3cd8_3            conda-forge
  yaml                       0.2.5              h280c20c_3            conda-forge
  zipp                       3.23.0             pyhcf101f3_1          conda-forge
  zstd                       1.5.7              hb78ec9c_6            conda-forge</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>