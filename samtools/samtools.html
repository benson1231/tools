<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-12-26">

<title>Samtools 基本使用</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="samtools_files/libs/clipboard/clipboard.min.js"></script>
<script src="samtools_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="samtools_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="samtools_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="samtools_files/libs/quarto-html/popper.min.js"></script>
<script src="samtools_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="samtools_files/libs/quarto-html/anchor.min.js"></script>
<link href="samtools_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="samtools_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="samtools_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="samtools_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="samtools_files/libs/bootstrap/bootstrap-91f297ac5b9b6094cb160b32f5ee6a0a.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="../styles/quarto.css">
</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="1">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#samtools-基本介紹" id="toc-samtools-基本介紹" class="nav-link active" data-scroll-target="#samtools-基本介紹"><span class="header-section-number">1</span> Samtools 基本介紹</a>
  <ul>
  <li><a href="#samtools-的主要功能" id="toc-samtools-的主要功能" class="nav-link" data-scroll-target="#samtools-的主要功能"><span class="header-section-number">1.1</span> Samtools 的主要功能</a></li>
  <li><a href="#samtools-的特色" id="toc-samtools-的特色" class="nav-link" data-scroll-target="#samtools-的特色"><span class="header-section-number">1.2</span> Samtools 的特色</a></li>
  <li><a href="#samtools-分析角色" id="toc-samtools-分析角色" class="nav-link" data-scroll-target="#samtools-分析角色"><span class="header-section-number">1.3</span> Samtools 分析角色</a></li>
  </ul></li>
  <li><a href="#samtools-version" id="toc-samtools-version" class="nav-link" data-scroll-target="#samtools-version"><span class="header-section-number">2</span> samtools –version</a></li>
  <li><a href="#samtools-faidx-建fasta索引" id="toc-samtools-faidx-建fasta索引" class="nav-link" data-scroll-target="#samtools-faidx-建fasta索引"><span class="header-section-number">3</span> samtools faidx (建FASTA索引)</a>
  <ul>
  <li><a href="#index-fasta" id="toc-index-fasta" class="nav-link" data-scroll-target="#index-fasta"><span class="header-section-number">3.1</span> index FASTA</a></li>
  </ul></li>
  <li><a href="#samtools-sort-排序" id="toc-samtools-sort-排序" class="nav-link" data-scroll-target="#samtools-sort-排序"><span class="header-section-number">4</span> samtools sort (排序)</a></li>
  <li><a href="#samtools-index-建bam索引" id="toc-samtools-index-建bam索引" class="nav-link" data-scroll-target="#samtools-index-建bam索引"><span class="header-section-number">5</span> samtools index (建BAM索引)</a></li>
  <li><a href="#samtools-view-轉檔篩選與過濾等" id="toc-samtools-view-轉檔篩選與過濾等" class="nav-link" data-scroll-target="#samtools-view-轉檔篩選與過濾等"><span class="header-section-number">6</span> samtools view (轉檔、篩選與過濾等)</a>
  <ul>
  <li><a href="#sam-轉-bam" id="toc-sam-轉-bam" class="nav-link" data-scroll-target="#sam-轉-bam"><span class="header-section-number">6.1</span> SAM 轉 BAM</a></li>
  <li><a href="#bam-轉-sam" id="toc-bam-轉-sam" class="nav-link" data-scroll-target="#bam-轉-sam"><span class="header-section-number">6.2</span> BAM 轉 SAM</a></li>
  <li><a href="#查看-bam-檔" id="toc-查看-bam-檔" class="nav-link" data-scroll-target="#查看-bam-檔"><span class="header-section-number">6.3</span> 查看 bam 檔</a></li>
  <li><a href="#搜尋特定區域" id="toc-搜尋特定區域" class="nav-link" data-scroll-target="#搜尋特定區域"><span class="header-section-number">6.4</span> 搜尋特定區域</a></li>
  <li><a href="#samtools-view-常用於進行篩選" id="toc-samtools-view-常用於進行篩選" class="nav-link" data-scroll-target="#samtools-view-常用於進行篩選"><span class="header-section-number">6.5</span> samtools view 常用於進行篩選</a></li>
  </ul></li>
  <li><a href="#samtools-flags-flag-解讀" id="toc-samtools-flags-flag-解讀" class="nav-link" data-scroll-target="#samtools-flags-flag-解讀"><span class="header-section-number">7</span> samtools flags (flag 解讀)</a></li>
  <li><a href="#samtools-flagstat" id="toc-samtools-flagstat" class="nav-link" data-scroll-target="#samtools-flagstat"><span class="header-section-number">8</span> samtools flagstat</a></li>
  <li><a href="#samtools-merge" id="toc-samtools-merge" class="nav-link" data-scroll-target="#samtools-merge"><span class="header-section-number">9</span> samtools merge</a></li>
  <li><a href="#samtools-coverage" id="toc-samtools-coverage" class="nav-link" data-scroll-target="#samtools-coverage"><span class="header-section-number">10</span> samtools coverage</a></li>
  <li><a href="#samtools-depth" id="toc-samtools-depth" class="nav-link" data-scroll-target="#samtools-depth"><span class="header-section-number">11</span> samtools depth</a>
  <ul>
  <li><a href="#計算平均深度" id="toc-計算平均深度" class="nav-link" data-scroll-target="#計算平均深度"><span class="header-section-number">11.1</span> 計算平均深度</a></li>
  </ul></li>
  <li><a href="#samtools-idxstats" id="toc-samtools-idxstats" class="nav-link" data-scroll-target="#samtools-idxstats"><span class="header-section-number">12</span> samtools idxstats</a></li>
  <li><a href="#samtools-stats" id="toc-samtools-stats" class="nav-link" data-scroll-target="#samtools-stats"><span class="header-section-number">13</span> samtools stats</a></li>
  <li><a href="#samtools-help" id="toc-samtools-help" class="nav-link" data-scroll-target="#samtools-help"><span class="header-section-number">14</span> samtools –help</a></li>
  <li><a href="#conda-環境資訊" id="toc-conda-環境資訊" class="nav-link" data-scroll-target="#conda-環境資訊"><span class="header-section-number">15</span> Conda 環境資訊</a></li>
  </ul>
<div class="quarto-other-links"><h2>Other Links</h2><ul><li><a href="https://benson1231.github.io/tools/"><i class="bi bi-house"></i>home</a></li></ul></div><div class="quarto-code-links"><h2>Code Links</h2><ul><li><a href="https://github.com/benson1231/tools"><i class="bi bi-github"></i>github</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Samtools 基本使用</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025-12-26</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="samtools-基本介紹" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Samtools 基本介紹</h1>
<p><a href="https://github.com/samtools/samtools">samtools</a> 是處理高通量定序（Next-Generation Sequencing, NGS）比對資料的核心工具套件，用於操作 SAM（Sequence Alignment/Map）與 BAM（Binary Alignment/Map）文件格式。SAM/BAM 是儲存序列與參考基因組比對結果的標準格式，而 samtools 提供快速、高效、彈性的指令協助使用者解析與管理這些資料。另外還有更高效能、高度平行的工具 <a href="https://github.com/biod/sambamba">sambamba</a>。</p>
<blockquote class="blockquote">
<p>Petr Danecek, James K Bonfield, Jennifer Liddle, John Marshall, Valeriu Ohan, Martin O Pollard, Andrew Whitwham, Thomas Keane, Shane A McCarthy, Robert M Davies, Heng Li GigaScience, Volume 10, Issue 2, February 2021, giab008, https://doi.org/10.1093/gigascience/giab008</p>
</blockquote>
<section id="samtools-的主要功能" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="samtools-的主要功能"><span class="header-section-number">1.1</span> Samtools 的主要功能</h2>
<p>samtools 涵蓋了 NGS 比對檔案處理的幾乎所有基礎步驟，包括：</p>
<ul>
<li>檔案格式轉換（SAM ↔︎ BAM）</li>
<li>排序（Sorting）與索引（Indexing）</li>
<li>區域擷取（Region Extraction）</li>
<li>基礎統計（flagstat, idxstats, coverage, stats）</li>
<li>檔案合併與拆分（merge, split）</li>
</ul>
</section>
<section id="samtools-的特色" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="samtools-的特色"><span class="header-section-number">1.2</span> Samtools 的特色</h2>
<ul>
<li><strong>高速、低記憶體需求</strong>：建立在 htslib 之上，效能優異</li>
<li><strong>與主流工具鏈相容</strong>：如 BWA、Bowtie2、GATK、DeepVariant、nf-core pipelines</li>
<li><strong>CLI 工作流程簡單、模組化</strong>：各指令可自由組合</li>
<li><strong>支援 CRAM 格式（壓縮率更高）</strong>：可在提供參考序列時大幅節省硬碟空間</li>
</ul>
</section>
<section id="samtools-分析角色" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="samtools-分析角色"><span class="header-section-number">1.3</span> Samtools 分析角色</h2>
<p>samtools 常用於以下生物資訊流程：</p>
<ul>
<li><strong>比對後處理（post-alignment processing）</strong></li>
<li><strong>品質檢查（QC）</strong>：檢查 mapping 成功率、深度是否正常</li>
<li><strong>擷取特定基因區域</strong>：Sanger validation、視覺化前資料抽取</li>
<li><strong>變異分析前的必要步驟</strong>：排序、索引、清理比對檔</li>
</ul>
<hr>
</section>
</section>
<section id="samtools-version" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> samtools –version</h1>
<p>使用 <code>--version</code> 參數確認 samtools 是否成功安裝，並顯示版本號。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> <span class="at">--version</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>samtools 1.23
Using htslib 1.23
Copyright (C) 2025 Genome Research Ltd.

Samtools compilation details:
    Features:       build=configure curses=yes 
    CC:             /opt/conda/conda-bld/samtools_1765917324003/_build_env/bin/x86_64-conda-linux-gnu-cc
    CPPFLAGS:       -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /home/benson/miniforge3/envs/bio-tools/include
    CFLAGS:         -Wall -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/benson/miniforge3/envs/bio-tools/include -fdebug-prefix-map=/opt/conda/conda-bld/samtools_1765917324003/work=/usr/local/src/conda/samtools-1.23 -fdebug-prefix-map=/home/benson/miniforge3/envs/bio-tools=/usr/local/src/conda-prefix
    LDFLAGS:        -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,--allow-shlib-undefined -Wl,-rpath,/home/benson/miniforge3/envs/bio-tools/lib -Wl,-rpath-link,/home/benson/miniforge3/envs/bio-tools/lib -L/home/benson/miniforge3/envs/bio-tools/lib
    HTSDIR:         
    LIBS:           
    CURSES_LIB:     -ltinfow -lncursesw

HTSlib compilation details:
    Features:       build=configure libcurl=yes S3=yes GCS=yes libdeflate=yes lzma=yes bzip2=yes plugins=yes plugin-path=/home/benson/miniforge3/envs/bio-tools/libexec/htslib htscodecs=1.6.5
    CC:             /opt/conda/conda-bld/htslib_1765902480168/_build_env/bin/x86_64-conda-linux-gnu-cc
    CPPFLAGS:       -DNDEBUG -D_FORTIFY_SOURCE=2 -O2 -isystem /home/benson/miniforge3/envs/bio-tools/include
    CFLAGS:         -Wall -march=nocona -mtune=haswell -ftree-vectorize -fPIC -fstack-protector-strong -fno-plt -O2 -ffunction-sections -pipe -isystem /home/benson/miniforge3/envs/bio-tools/include -fdebug-prefix-map=/opt/conda/conda-bld/htslib_1765902480168/work=/usr/local/src/conda/htslib-1.23 -fdebug-prefix-map=/home/benson/miniforge3/envs/bio-tools=/usr/local/src/conda-prefix -fvisibility=hidden
    LDFLAGS:        -Wl,-O2 -Wl,--sort-common -Wl,--as-needed -Wl,-z,relro -Wl,-z,now -Wl,--disable-new-dtags -Wl,--gc-sections -Wl,--allow-shlib-undefined -Wl,-rpath,/home/benson/miniforge3/envs/bio-tools/lib -Wl,-rpath-link,/home/benson/miniforge3/envs/bio-tools/lib -L/home/benson/miniforge3/envs/bio-tools/lib -fvisibility=hidden -rdynamic

HTSlib URL scheme handlers present:
    built-in:    file, preload, data
    Amazon S3:   s3+https, s3, s3+http
    Google Cloud Storage:    gs+http, gs+https, gs
    libcurl:     gophers, smtp, wss, smb, rtsp, tftp, pop3, smbs, imaps, pop3s, ws, ftps, https, http, ftp, gopher, imap, sftp, smtps, scp, dict, mqtt, telnet
    crypt4gh-needed:     crypt4gh
    mem:     mem</code></pre>
</div>
</div>
<hr>
</section>
<section id="samtools-faidx-建fasta索引" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> samtools faidx (建FASTA索引)</h1>
<section id="index-fasta" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="index-fasta"><span class="header-section-number">3.1</span> index FASTA</h2>
<p>建立 FASTA index</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> faidx ../.test/ex1.fa</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
</section>
<section id="samtools-sort-排序" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> samtools sort (排序)</h1>
<p>對 BAM 檔排序，以利後續建立索引或快速查詢。</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> sort <span class="at">-o</span> ../.test/ex1.sorted.bam ../.test/ex1.bam</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
<section id="samtools-index-建bam索引" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> samtools index (建BAM索引)</h1>
<p>建立 bam 檔的 index file <code>bai</code>，供後續索引</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb5"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> index ../.test/ex1.sorted.bam</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
<section id="samtools-view-轉檔篩選與過濾等" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> samtools view (轉檔、篩選與過濾等)</h1>
<p><code>samtools view</code> 是 samtools 套件中最常使用的指令之一，負責從 SAM/BAM/CRAM 中擷取資料、轉換格式、過濾 reads、以及抽取區域。透過不同參數組合，可快速針對 mapping 品質、FLAG 標記、比對狀態等條件進行篩選，是 NGS 分析中不可或缺的核心指令。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb6"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">--help</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Usage: samtools view [options] &lt;in.bam&gt;|&lt;in.sam&gt;|&lt;in.cram&gt; [region ...]

Output options:
  -b, --bam                  Output BAM
  -C, --cram                 Output CRAM (requires -T)
  -1, --fast                 Use fast BAM compression (and default to --bam)
  -u, --uncompressed         Uncompressed BAM output (and default to --bam)
  -h, --with-header          Include header in SAM output
  -H, --header-only          Print SAM header only (no alignments)
      --no-header            Print SAM alignment records only [default]
  -c, --count                Print only the count of matching records
      --save-counts FILE     Write counts of passed/failed records to FILE
  -o, --output FILE          Write output to FILE [standard output]
  -U, --unoutput FILE, --output-unselected FILE
                             Output reads not selected by filters to FILE
  -p, --unmap                Set flag to UNMAP on reads not selected
                             then write to output file.
  -P, --fetch-pairs          Retrieve complete pairs even when outside of region

Input options:
  -t, --fai-reference FILE   FILE listing reference names and lengths
  -M, --use-index            Use index and multi-region iterator for regions
      --region[s]-file FILE  Use index to include only reads overlapping FILE
  -X, --customized-index     Expect extra index file argument after &lt;in.bam&gt;

Filtering options (Only include in output reads that...):
  -L, --target[s]-file FILE  ...overlap (BED) regions in FILE
  -N, --qname-file [^]FILE   ...whose read name is listed in FILE ("^" negates)
  -r, --read-group STR       ...are in read group STR or in no read group
  -R, --read-group-file [^]FILE
                             ...are in a read group listed in FILE or in none
  -n, --exclude-no-read_group
                             ...have a read group, exclude those that have not
  -d, --tag STR1[:STR2]      ...have a tag STR1 (with associated value STR2)
  -D, --tag-file STR:FILE    ...have a tag STR whose value is listed in FILE
  -q, --min-MQ INT           ...have mapping quality &gt;= INT
  -l, --library STR          ...are in library STR
  -m, --min-qlen INT         ...cover &gt;= INT query bases (as measured via CIGAR)
  -e, --expr STR             ...match the filter expression STR
  -f, --require-flags FLAG   ...have all of the FLAGs present
  -F, --excl[ude]-flags FLAG ...have none of the FLAGs present
      --rf, --incl-flags, --include-flags FLAG
                             ...have some of the FLAGs present
  -G FLAG                    EXCLUDE reads with all of the FLAGs present
      --subsample FLOAT      Keep only FLOAT fraction of templates/read pairs
      --subsample-seed INT   Influence WHICH reads are kept in subsampling [0]
  -s INT.FRAC                Same as --subsample 0.FRAC --subsample-seed INT

Processing options:
      --add-flags FLAG       Add FLAGs to reads
      --remove-flags FLAG    Remove FLAGs from reads
  -x, --remove-tag STR
               Comma-separated read tags to strip (repeatable) [null]
      --keep-tag STR
               Comma-separated read tags to preserve (repeatable) [null].
               Equivalent to "-x ^STR"
  -B, --remove-B             Collapse the backward CIGAR operation
  -z, --sanitize FLAGS       Perform sanitity checking and fixing on records.
                             FLAGS is comma separated (see manual). [off]

General options:
  -?, --help   Print long help, including note about region specification
  -S           Ignored (input format is auto-detected)
      --no-PG  Do not add a PG line
      --input-fmt-option OPT[=VAL]
               Specify a single input file format option in the form
               of OPTION or OPTION=VALUE
  -O, --output-fmt FORMAT[,OPT[=VAL]]...
               Specify output format (SAM, BAM, CRAM)
      --output-fmt-option OPT[=VAL]
               Specify a single output file format option in the form
               of OPTION or OPTION=VALUE
  -T, --reference FILE
               Reference sequence FASTA FILE [null]
  -@, --threads INT
               Number of additional threads to use [0]
      --write-index
               Automatically index the output files [off]
      --verbosity INT
               Set level of verbosity

See https://www.htslib.org/doc/samtools.html#GLOBAL_COMMAND_OPTIONS
for more details.

Notes:

1. This command now auto-detects the input format (BAM/CRAM/SAM).
   Further control over the CRAM format can be specified by using the
   --output-fmt-option, e.g. to specify the number of sequences per slice
   and to use avoid reference based compression:

    samtools view -C --output-fmt-option seqs_per_slice=5000 \
       --output-fmt-option no_ref -o out.cram in.bam

   Options can also be specified as a comma separated list within the
   --output-fmt value too.  For example this is equivalent to the above

    samtools view --output-fmt cram,seqs_per_slice=5000,no_ref \
       -o out.cram in.bam

2. The file supplied with `-t' is SPACE/TAB delimited with the first
   two fields of each line consisting of the reference name and the
   corresponding sequence length. The `.fai' file generated by 
   `samtools faidx' is suitable for use as this file. This may be an
   empty file if reads are unaligned.

3. SAM-&gt;BAM conversion:  samtools view -bT ref.fa in.sam.gz

4. BAM-&gt;SAM conversion:  samtools view -h in.bam

5. A region should be presented in one of the following formats:
   `chr1', `chr2:1,000' and `chr3:1000-2,000'. When a region is
   specified, the input alignment file must be a sorted and indexed
   alignment (BAM/CRAM) file.

6. Option `-u' is preferred over `-b' when the output is piped to
   another samtools command.

7. Option `-M`/`--use-index` causes overlaps with `-L` BED file regions and
   command-line region arguments to be computed using the multi-region iterator
   and an index. This increases speed, omits duplicates, and outputs the reads
   as they are ordered in the input SAM/BAM/CRAM file.

8. Options `-L`/`--target[s]-file` and `--region[s]-file` may not be used
   together. `--region[s]-file FILE` is simply equivalent to `-M -L FILE`,
   so using both causes one of the specified BED files to be ignored.</code></pre>
</div>
</div>
<section id="sam-轉-bam" class="level2" data-number="6.1">
<h2 data-number="6.1" class="anchored" data-anchor-id="sam-轉-bam"><span class="header-section-number">6.1</span> SAM 轉 BAM</h2>
<p><code>-b</code> 輸出bam，<code>-t</code> 提供 FASTA index(.fai)供 SAM 轉換 BAM，<code>-o &lt;output.bam&gt;</code> 指定輸出 BAM 檔的名稱</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb8"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-b</span> <span class="at">-t</span> ../.test/ex1.fa.fai <span class="at">-o</span> ../.test/ex1.bam ../.test/ex1.sam.gz</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="bam-轉-sam" class="level2" data-number="6.2">
<h2 data-number="6.2" class="anchored" data-anchor-id="bam-轉-sam"><span class="header-section-number">6.2</span> BAM 轉 SAM</h2>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb9"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-h</span> <span class="at">-o</span> ../.test/ex1.sam.gz ../.test/ex1.bam</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="查看-bam-檔" class="level2" data-number="6.3">
<h2 data-number="6.3" class="anchored" data-anchor-id="查看-bam-檔"><span class="header-section-number">6.3</span> 查看 bam 檔</h2>
<p>default 不包含header，<code>-h</code> 含 header，<code>-H</code> 只看 header</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看所有比對結果（不含 header）</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view ../.test/ex1.bam <span class="kw">|</span> <span class="fu">head</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>B7_591:4:96:693:509 73  seq1    1   99  36M *   0   0   CACTAGTGGCTCATTGTAAATGTGTGGTTTAACTCG    &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;5&lt;&lt;&lt;&lt;&lt;;:&lt;;7    MF:i:18 Aq:i:73 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
EAS54_65:7:152:368:113  73  seq1    3   99  35M *   0   0   CTAGTGGCTCATTGTAAATGTGTGGTTTAACTCGT &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;0&lt;&lt;&lt;&lt;655&lt;&lt;7&lt;&lt;&lt;:9&lt;&lt;3/:&lt;6): MF:i:18 Aq:i:66 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
EAS51_64:8:5:734:57 137 seq1    5   99  35M *   0   0   AGTGGCTCATTGTAAATGTGTGGTTTAACTCGTCC &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;7;71&lt;&lt;;&lt;;;&lt;7;&lt;&lt;3;);3*8/5 MF:i:18 Aq:i:66 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
B7_591:1:289:587:906    137 seq1    6   63  36M *   0   0   GTGGCTCATTGTAATTTTTTGTTTTAACTCTTCTCT    (-&amp;----,----)-)-),'--)---',+-,),''*,    MF:i:130    Aq:i:63 NM:i:5  UQ:i:38 H0:i:0  H1:i:0
EAS56_59:8:38:671:758   137 seq1    9   99  35M *   0   0   GCTCATTGTAAATGTGTGGTTTAACTCGTCCATGG &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt;;7&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;7&lt;&lt;;:&lt;5% MF:i:18 Aq:i:72 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
EAS56_61:6:18:467:281   73  seq1    13  99  35M *   0   0   ATTGTAAATGTGTGGTTTAACTCGTCCCTGGCCCA &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt;&lt;&lt;8&lt;&lt;&lt;&lt;&lt;;8:;6/686&amp;;(16666 MF:i:18 Aq:i:39 NM:i:1  UQ:i:5  H0:i:0  H1:i:1
EAS114_28:5:296:340:699 137 seq1    13  99  36M *   0   0   ATTGTAAATGTGTGGTTTAACTCGTCCATGGCCCAG    &lt;&lt;&lt;&lt;&lt;;&lt;&lt;&lt;;&lt;;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;8&lt;8&lt;3&lt;8;&lt;;&lt;0;    MF:i:18 Aq:i:73 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
B7_597:6:194:894:408    73  seq1    15  99  35M *   0   0   TGTAAATGTGTGGTTTAACTCGTCCATTGCCCAGC &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;7&lt;&lt;;&lt;&lt;&lt;&lt;;&lt;&lt;&lt;7;;&lt;&lt;&lt;*,;;572&lt; MF:i:18 Aq:i:43 NM:i:1  UQ:i:9  H0:i:0  H1:i:1
EAS188_4:8:12:628:973   89  seq1    18  75  35M *   0   0   AAATGTGTGGTTTAACTCGTCCATGGCCCAGCATT ==;=:;:;;:====;=;===:=======;==;=== MF:i:64 Aq:i:0  NM:i:0  UQ:i:0  H0:i:1  H1:i:0
EAS51_66:7:68:402:50    137 seq1    22  99  35M *   0   0   GTGTGGTTTAACTCGTCCATGGCCCAGCATTTGGG &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;:&lt;&lt;&lt;9&lt;6;9;;&amp;697;7&amp;&lt;55 MF:i:18 Aq:i:66 NM:i:1  UQ:i:5  H0:i:1  H1:i:0</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看所有比對結果（含 header）</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-h</span> ../.test/ex1.bam <span class="kw">|</span> <span class="fu">head</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>@SQ SN:seq1 LN:1575
@SQ SN:seq2 LN:1584
@PG ID:samtools PN:samtools VN:1.23 CL:samtools view -b -t ../.test/ex1.fa.fai -o ../.test/ex1.bam ../.test/ex1.sam.gz
@PG ID:samtools.1   PN:samtools PP:samtools VN:1.23 CL:samtools view -h -o ../.test/ex1.sam.gz ../.test/ex1.bam
@PG ID:samtools.2   PN:samtools PP:samtools.1   VN:1.23 CL:samtools view -b -t ../.test/ex1.fa.fai -o ../.test/ex1.bam ../.test/ex1.sam.gz
@PG ID:samtools.3   PN:samtools PP:samtools.2   VN:1.23 CL:samtools view -h -o ../.test/ex1.sam.gz ../.test/ex1.bam
@PG ID:samtools.4   PN:samtools PP:samtools.3   VN:1.23 CL:samtools view -b -t ../.test/ex1.fa.fai -o ../.test/ex1.bam ../.test/ex1.sam.gz
@PG ID:samtools.5   PN:samtools PP:samtools.4   VN:1.23 CL:samtools view -h -o ../.test/ex1.sam.gz ../.test/ex1.bam
@PG ID:samtools.6   PN:samtools PP:samtools.5   VN:1.23 CL:samtools view -b -t ../.test/ex1.fa.fai -o ../.test/ex1.bam ../.test/ex1.sam.gz
@PG ID:samtools.7   PN:samtools PP:samtools.6   VN:1.23 CL:samtools view -h ../.test/ex1.bam</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb14"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 只輸出 BAM 的 header</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-H</span> ../.test/ex1.bam</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>@SQ SN:seq1 LN:1575
@SQ SN:seq2 LN:1584
@PG ID:samtools PN:samtools VN:1.23 CL:samtools view -b -t ../.test/ex1.fa.fai -o ../.test/ex1.bam ../.test/ex1.sam.gz
@PG ID:samtools.1   PN:samtools PP:samtools VN:1.23 CL:samtools view -h -o ../.test/ex1.sam.gz ../.test/ex1.bam
@PG ID:samtools.2   PN:samtools PP:samtools.1   VN:1.23 CL:samtools view -b -t ../.test/ex1.fa.fai -o ../.test/ex1.bam ../.test/ex1.sam.gz
@PG ID:samtools.3   PN:samtools PP:samtools.2   VN:1.23 CL:samtools view -h -o ../.test/ex1.sam.gz ../.test/ex1.bam
@PG ID:samtools.4   PN:samtools PP:samtools.3   VN:1.23 CL:samtools view -b -t ../.test/ex1.fa.fai -o ../.test/ex1.bam ../.test/ex1.sam.gz
@PG ID:samtools.5   PN:samtools PP:samtools.4   VN:1.23 CL:samtools view -h -o ../.test/ex1.sam.gz ../.test/ex1.bam
@PG ID:samtools.6   PN:samtools PP:samtools.5   VN:1.23 CL:samtools view -b -t ../.test/ex1.fa.fai -o ../.test/ex1.bam ../.test/ex1.sam.gz
@PG ID:samtools.7   PN:samtools PP:samtools.6   VN:1.23 CL:samtools view -H ../.test/ex1.bam</code></pre>
</div>
</div>
</section>
<section id="搜尋特定區域" class="level2" data-number="6.4">
<h2 data-number="6.4" class="anchored" data-anchor-id="搜尋特定區域"><span class="header-section-number">6.4</span> 搜尋特定區域</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 提取 chr2 450-550 的比對結果</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view ../.test/ex1.sorted.bam seq2:450-550 <span class="kw">|</span> <span class="fu">head</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>EAS1_108:1:33:779:821   163 seq2    416 99  35M =   579 198 TGAAGGAAAAAAATTCTAAAATCAGCAAGAGAAAA &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt;&lt;;&lt;&lt; MF:i:18 Aq:i:30 NM:i:0  UQ:i:0  H0:i:1  H1:i:3
EAS112_34:6:75:615:555  147 seq2    416 99  35M =   255 -196    TGAAGGAAAAAAATTCTAAAATCAGCAAGAGAAAA ;&lt;&lt;&lt;;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;:;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; MF:i:18 Aq:i:30 NM:i:0  UQ:i:0  H0:i:2  H1:i:0
EAS188_7:6:11:994:584   147 seq2    417 97  35M =   226 -226    GAAGGAAAAAAATTCTAAAATCAGCAAGAGAAAAG &lt;&lt;&lt;&lt;;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt;:&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; MF:i:18 Aq:i:24 NM:i:0  UQ:i:0  H0:i:2  H1:i:0
EAS114_26:7:218:858:445 147 seq2    421 99  35M =   239 -217    GAAAAAAATTCTAAAATCAGCAAGAGAAAAGCATA ;&lt;&lt;&lt;&lt;&lt;&lt;&lt;8;:&lt;&lt;&lt;&lt;&lt;&lt;;&lt;&lt;:&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt; MF:i:18 Aq:i:27 NM:i:0  UQ:i:0  H0:i:1  H1:i:1
EAS220_1:4:70:766:2016  163 seq2    422 99  35M =   607 220 AAAAAAATTCTAAAATCAGCAAGAGAAAAGCATAC &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; MF:i:18 Aq:i:30 NM:i:0  UQ:i:0  H0:i:2  H1:i:0
EAS54_81:2:317:72:221   83  seq2    422 99  35M =   270 -187    AAAAAAATTCTAAAATCAGCAAGAGAAAAGCATAC =========:======;==;=============== MF:i:18 Aq:i:53 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
EAS56_53:4:45:707:147   83  seq2    424 99  35M =   216 -243    AAAAATTCTAAAATCAGCAAGAGAAAAGCATACAG &lt;&lt;&lt;&lt;&lt;&lt;;3&lt;&lt;&lt;&lt;&lt;4;&lt;&lt;;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; MF:i:18 Aq:i:51 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
EAS219_1:7:16:1343:1621 147 seq2    426 99  35M =   248 -213    AAATTCTAAAATCAGCAAGAGAAAAGCATACAGTC ;&lt;&lt;9;7=====;;==&lt;==================&lt; MF:i:18 Aq:i:71 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
B7_595:5:184:912:258    99  seq2    428 99  35M =   582 189 ATTCTAAAATCAGCAAGAGAAAAGCATACAGTCAT &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt; MF:i:18 Aq:i:76 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
EAS51_62:5:119:38:945   147 seq2    428 99  35M =   221 -242    ATTCTAAAATCAGCAAGAGAAAAGCATACAGTCAT =;;8=====:========&lt;================ MF:i:18 Aq:i:74 NM:i:0  UQ:i:0  H0:i:1  H1:i:0</code></pre>
</div>
</div>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 根據 BED 檔指定區域提取比對</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> view <span class="at">-L</span> ../.test/ex1.bed ../.test/ex1.sorted.bam <span class="kw">|</span> <span class="fu">head</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>EAS1_108:1:33:779:821   163 seq2    416 99  35M =   579 198 TGAAGGAAAAAAATTCTAAAATCAGCAAGAGAAAA &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt;&lt;;&lt;&lt; MF:i:18 Aq:i:30 NM:i:0  UQ:i:0  H0:i:1  H1:i:3
EAS112_34:6:75:615:555  147 seq2    416 99  35M =   255 -196    TGAAGGAAAAAAATTCTAAAATCAGCAAGAGAAAA ;&lt;&lt;&lt;;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;:;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; MF:i:18 Aq:i:30 NM:i:0  UQ:i:0  H0:i:2  H1:i:0
EAS188_7:6:11:994:584   147 seq2    417 97  35M =   226 -226    GAAGGAAAAAAATTCTAAAATCAGCAAGAGAAAAG &lt;&lt;&lt;&lt;;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt;:&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; MF:i:18 Aq:i:24 NM:i:0  UQ:i:0  H0:i:2  H1:i:0
EAS114_26:7:218:858:445 147 seq2    421 99  35M =   239 -217    GAAAAAAATTCTAAAATCAGCAAGAGAAAAGCATA ;&lt;&lt;&lt;&lt;&lt;&lt;&lt;8;:&lt;&lt;&lt;&lt;&lt;&lt;;&lt;&lt;:&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt; MF:i:18 Aq:i:27 NM:i:0  UQ:i:0  H0:i:1  H1:i:1
EAS220_1:4:70:766:2016  163 seq2    422 99  35M =   607 220 AAAAAAATTCTAAAATCAGCAAGAGAAAAGCATAC &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; MF:i:18 Aq:i:30 NM:i:0  UQ:i:0  H0:i:2  H1:i:0
EAS54_81:2:317:72:221   83  seq2    422 99  35M =   270 -187    AAAAAAATTCTAAAATCAGCAAGAGAAAAGCATAC =========:======;==;=============== MF:i:18 Aq:i:53 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
EAS56_53:4:45:707:147   83  seq2    424 99  35M =   216 -243    AAAAATTCTAAAATCAGCAAGAGAAAAGCATACAG &lt;&lt;&lt;&lt;&lt;&lt;;3&lt;&lt;&lt;&lt;&lt;4;&lt;&lt;;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; MF:i:18 Aq:i:51 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
EAS219_1:7:16:1343:1621 147 seq2    426 99  35M =   248 -213    AAATTCTAAAATCAGCAAGAGAAAAGCATACAGTC ;&lt;&lt;9;7=====;;==&lt;==================&lt; MF:i:18 Aq:i:71 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
B7_595:5:184:912:258    99  seq2    428 99  35M =   582 189 ATTCTAAAATCAGCAAGAGAAAAGCATACAGTCAT &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;;&lt; MF:i:18 Aq:i:76 NM:i:0  UQ:i:0  H0:i:1  H1:i:0
EAS51_62:5:119:38:945   147 seq2    428 99  35M =   221 -242    ATTCTAAAATCAGCAAGAGAAAAGCATACAGTCAT =;;8=====:========&lt;================ MF:i:18 Aq:i:74 NM:i:0  UQ:i:0  H0:i:1  H1:i:0</code></pre>
</div>
</div>
</section>
<section id="samtools-view-常用於進行篩選" class="level2" data-number="6.5">
<h2 data-number="6.5" class="anchored" data-anchor-id="samtools-view-常用於進行篩選"><span class="header-section-number">6.5</span> samtools view 常用於進行篩選</h2>
<table class="caption-top table">
<colgroup>
<col style="width: 21%">
<col style="width: 22%">
<col style="width: 23%">
<col style="width: 32%">
</colgroup>
<thead>
<tr class="header">
<th>選項</th>
<th>說明</th>
<th>常見用途</th>
<th>範例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>-q INT</code></td>
<td>依 <strong>mapping quality</strong> 過濾 reads</td>
<td>去除低品質比對</td>
<td><code>samtools view -q 20 sample.bam</code></td>
</tr>
<tr class="even">
<td><code>-f FLAG</code></td>
<td>只保留符合 FLAG 的 reads</td>
<td>保留 properly paired、first/second</td>
<td><code>samtools view -f 2 sample.bam</code></td>
</tr>
<tr class="odd">
<td><code>-F FLAG</code></td>
<td>排除符合 FLAG 的 reads</td>
<td>排除 unmapped、secondary、duplicate</td>
<td><code>samtools view -F 4 sample.bam</code></td>
</tr>
<tr class="even">
<td><code>-h</code></td>
<td>輸出 header + reads</td>
<td>保留 header 的 SAM 格式輸出</td>
<td><code>samtools view -h sample.bam</code></td>
</tr>
<tr class="odd">
<td><code>-H</code></td>
<td>只輸出 header</td>
<td>查看 BAM header</td>
<td><code>samtools view -H sample.bam</code></td>
</tr>
<tr class="even">
<td><code>-L bed-file</code></td>
<td>依 BED 區域擷取 reads</td>
<td>多區域抽取</td>
<td><code>samtools view -L targets.bed sample.bam</code></td>
</tr>
<tr class="odd">
<td><code>-@ INT</code></td>
<td>使用多核心運算</td>
<td>加速大 BAM 解析</td>
<td><code>samtools view -@ 8 sample.bam</code></td>
</tr>
<tr class="even">
<td><code>--bam</code> / <code>--cram</code></td>
<td>指定輸出格式</td>
<td>強制轉換格式</td>
<td><code>samtools view --cram input.bam</code></td>
</tr>
<tr class="odd">
<td><code>region</code>（如 chr:start-end）</td>
<td>擷取特定座標區段</td>
<td>基因區域分析</td>
<td><code>samtools view sample.bam chr1:10000-20000</code></td>
</tr>
</tbody>
</table>
<hr>
</section>
</section>
<section id="samtools-flags-flag-解讀" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> samtools flags (flag 解讀)</h1>
<p><code>samtools flags</code> 用於查詢 SAM/BAM FLAG 的 bit 組合與含義，可協助判讀 <code>samtools view -f</code> 與 <code>-F</code> 的篩選條件。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> flags</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>About: Convert between textual and numeric flag representation
Usage: samtools flags FLAGS...

Each FLAGS argument is either an INT (in decimal/hexadecimal/octal) representing
a combination of the following numeric flag values, or a comma-separated string
NAME,...,NAME representing a combination of the following flag names:

   0x1     1  PAIRED         paired-end / multiple-segment sequencing technology
   0x2     2  PROPER_PAIR    each segment properly aligned according to aligner
   0x4     4  UNMAP          segment unmapped
   0x8     8  MUNMAP         next segment in the template unmapped
  0x10    16  REVERSE        SEQ is reverse complemented
  0x20    32  MREVERSE       SEQ of next segment in template is rev.complemented
  0x40    64  READ1          the first segment in the template
  0x80   128  READ2          the last segment in the template
 0x100   256  SECONDARY      secondary alignment
 0x200   512  QCFAIL         not passing quality controls or other filters
 0x400  1024  DUP            PCR or optical duplicate
 0x800  2048  SUPPLEMENTARY  supplementary alignment</code></pre>
</div>
</div>
<p><code>samtools flags &lt;INT&gt;</code> 可以解析該 FLAG 整數所代表的 bit 與狀態</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> flags 2</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> flags 4</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>0x2 2   PROPER_PAIR
0x4 4   UNMAP</code></pre>
</div>
</div>
<hr>
</section>
<section id="samtools-flagstat" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> samtools flagstat</h1>
<p><code>samtools flagstat</code> 會讀取 BAM/SAM/CRAM，並輸出一段簡短但非常重要的 mapping 統計，包括： read 總數、mapped reads 比例、properly paired 比例、duplicates 數量、singletons 數量、mate mapping 狀況（同 chr / diff chr）、QC-failed reads</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> flagstat ../.test/ex1.bam</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>3307 + 0 in total (QC-passed reads + QC-failed reads)
3307 + 0 primary
0 + 0 secondary
0 + 0 supplementary
0 + 0 duplicates
0 + 0 primary duplicates
3271 + 0 mapped (98.91% : N/A)
3271 + 0 primary mapped (98.91% : N/A)
3307 + 0 paired in sequencing
1654 + 0 read1
1653 + 0 read2
3144 + 0 properly paired (95.07% : N/A)
3144 + 0 with itself and mate mapped
127 + 0 singletons (3.84% : N/A)
0 + 0 with mate mapped to a different chr
0 + 0 with mate mapped to a different chr (mapQ&gt;=5)</code></pre>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 27%">
<col style="width: 25%">
<col style="width: 27%">
</colgroup>
<thead>
<tr class="header">
<th>欄位名稱</th>
<th>說明</th>
<th>代表意義</th>
<th>常見 QC 解讀</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>in total</strong></td>
<td>總 reads 數（QC-passed + QC-failed）</td>
<td>原始讀序的整體數量</td>
<td>數量是否符合預期？太低可能是 library 問題</td>
</tr>
<tr class="even">
<td><strong>primary</strong></td>
<td>primary alignment 數（排除 secondary/supplementary）</td>
<td>用於主要分析的 reads</td>
<td>primary 過低 → mapping 混亂或多重比對過多</td>
</tr>
<tr class="odd">
<td><strong>secondary</strong></td>
<td>secondary alignment（多重比對）</td>
<td>aligner 找到多個 mapping 位置</td>
<td>過高 → 重複序列或 mapping 參數寬鬆</td>
</tr>
<tr class="even">
<td><strong>supplementary</strong></td>
<td>supplementary alignment（如 chimeric read）</td>
<td>split-read mapping</td>
<td>過高可能代表結構變異或 chimera</td>
</tr>
<tr class="odd">
<td><strong>mapped</strong></td>
<td>成功比對到參考序列的 reads（%）</td>
<td>mapping rate（最重要 QC 指標之一）</td>
<td>WGS/WES 通常 &gt;90%；太低可能是污染或物種不符</td>
</tr>
<tr class="even">
<td><strong>paired in sequencing</strong></td>
<td>paired-end 資料中成對的 reads</td>
<td>應等於總 PE reads</td>
<td>若意外偏低 → 資料不完整或文件損壞</td>
</tr>
<tr class="odd">
<td><strong>read1 / read2</strong></td>
<td>read1 及 read2 的數量</td>
<td>正常應接近相等</td>
<td>不平衡 → sample degrade 或跑 Lane 不均</td>
</tr>
<tr class="even">
<td><strong>properly paired</strong></td>
<td>合理方向 + 合理距離的 read pairs</td>
<td>alignment 品質是否正常</td>
<td>WGS 通常 &gt;90%；太低 → insert size 問題或 contamination</td>
</tr>
<tr class="odd">
<td><strong>with itself and mate mapped</strong></td>
<td>read 與其 mate 都成功比對</td>
<td>paired-end mapping 完整性</td>
<td>若低 → read2 不齊全（如跑丟一端）</td>
</tr>
<tr class="even">
<td><strong>singletons</strong></td>
<td>只有一端比對成功</td>
<td>library degrade、read 质量差或 RNA fragmentation</td>
<td>WGS 通常 &lt;3%；高可能代表 sample degrade</td>
</tr>
<tr class="odd">
<td><strong>mate mapped to a different chr</strong></td>
<td>mate pair 在不同染色體</td>
<td>可能是真實結構變異、錯配、或 mapping 錯誤</td>
<td>過高可能是污染或 aligner 參數過寬</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="samtools-merge" class="level1" data-number="9">
<h1 data-number="9"><span class="header-section-number">9</span> samtools merge</h1>
<p>用於合併多個 BAM 檔為單一檔案。</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb26"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> merge <span class="at">-o</span> ../.test/merge.bam ../.test/ex1.bam ../.test/ex1.sorted.bam</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
<section id="samtools-coverage" class="level1" data-number="10">
<h1 data-number="10"><span class="header-section-number">10</span> samtools coverage</h1>
<p><code>samtools coverage</code> 用於計算每條染色體的平均深度（mean depth）、覆蓋率（coverage%）與一些區域性統計資訊。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> coverage ../.test/ex1.sorted.bam</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>#rname  startpos    endpos  numreads    covbases    coverage    meandepth   meanbaseq   meanmapq
seq1    1   1575    1482    1569    99.619  33.1213 25.5    96.1
seq2    1   1584    1789    1567    98.9268 39.7822 26  90.8</code></pre>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 13%">
<col style="width: 25%">
<col style="width: 17%">
<col style="width: 43%">
</colgroup>
<thead>
<tr class="header">
<th>欄位名稱</th>
<th>說明</th>
<th>代表意義</th>
<th>常見 QC 解讀</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>rname</strong></td>
<td>參考序列名稱（染色體/contig）</td>
<td>統計對應到哪條染色體</td>
<td>用於檢查 coverage 是否在不同染色體間均勻</td>
</tr>
<tr class="even">
<td><strong>startpos</strong></td>
<td>區域起始位置</td>
<td>一般為 1</td>
<td>無特別 QC 使用，作為範圍參考</td>
</tr>
<tr class="odd">
<td><strong>endpos</strong></td>
<td>區域終止位置</td>
<td>等於染色體長度</td>
<td>無特別 QC 使用，作為範圍參考</td>
</tr>
<tr class="even">
<td><strong>numreads</strong></td>
<td>覆蓋該染色體的 reads 數量</td>
<td>用來判斷 reads 在各染色體的分布狀況</td>
<td>若某染色體過低 → 可能 mapping 偏差或樣本問題</td>
</tr>
<tr class="odd">
<td><strong>covbases</strong></td>
<td>被 ≥1 read 覆蓋的碱基數量</td>
<td>計算 coverage% 的分子</td>
<td>若明顯偏低 → dropout、capture 不良、mapping 問題</td>
</tr>
<tr class="even">
<td><strong>coverage (%)</strong></td>
<td>covbases / endpos × 100</td>
<td>染色體實際覆蓋率</td>
<td>WGS/WES 需接近 100%；panel 低 coverage 會造成 false negative</td>
</tr>
<tr class="odd">
<td><strong>meandepth</strong></td>
<td>平均深度（mean depth）</td>
<td>最重要深度 QC 指標</td>
<td>WGS 30X/60X；WES/panel 依設計不同，過低會影響 variant calling</td>
</tr>
<tr class="even">
<td><strong>meanbaseq</strong></td>
<td>覆蓋到之碱基的平均 base quality</td>
<td>Reads 序列品質代表</td>
<td>若偏低 → read 品質差或 instrument 問題</td>
</tr>
<tr class="odd">
<td><strong>meanmapq</strong></td>
<td>覆蓋到之 reads 的平均 mapping quality</td>
<td>對齊品質指標</td>
<td>&lt;30 代表 mapping 可能不可靠、參考序列不符或比對參數錯誤</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="samtools-depth" class="level1" data-number="11">
<h1 data-number="11"><span class="header-section-number">11</span> samtools depth</h1>
<p><code>samtools depth</code> 用於輸出 BAM 中 每個位置（per-base） 的深度（depth）</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb29"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> depth ../.test/ex1.sorted.bam <span class="kw">|</span> <span class="fu">head</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>seq1    1   1
seq1    2   1
seq1    3   2
seq1    4   2
seq1    5   3
seq1    6   4
seq1    7   4
seq1    8   4
seq1    9   5
seq1    10  5</code></pre>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 14%">
<col style="width: 17%">
<col style="width: 23%">
<col style="width: 44%">
</colgroup>
<thead>
<tr class="header">
<th>欄位</th>
<th>名稱</th>
<th>說明</th>
<th>QC 用途</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>chrom</strong></td>
<td>染色體名稱</td>
<td>比對到的參考序列名稱</td>
<td>用於識別區域 depth 分布</td>
</tr>
<tr class="even">
<td><strong>pos</strong></td>
<td>位置（1-based）</td>
<td>該位置在參考基因組的座標</td>
<td>用來定位 low-depth 或 dropout 位置</td>
</tr>
<tr class="odd">
<td><strong>depth</strong></td>
<td>read 深度</td>
<td>覆蓋該位置的 reads 數目</td>
<td>panel/WES 最主要 coverage QC 資料</td>
</tr>
</tbody>
</table>
<section id="計算平均深度" class="level2" data-number="11.1">
<h2 data-number="11.1" class="anchored" data-anchor-id="計算平均深度"><span class="header-section-number">11.1</span> 計算平均深度</h2>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb31"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> depth ../.test/ex1.sorted.bam <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'{sum += $3} END {print sum/NR}'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>36.7286</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="samtools-idxstats" class="level1" data-number="12">
<h1 data-number="12"><span class="header-section-number">12</span> samtools idxstats</h1>
<p><code>samtools idxstats</code> 用於顯示 每條染色體的 read 數量與參考序列長度，依靠 BAM 的 index (.bai 或 .csi)</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb33"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> idxstats ../.test/ex1.sorted.bam</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>seq1    1575    1482    19
seq2    1584    1789    17
*   0   0   0</code></pre>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 15%">
<col style="width: 25%">
<col style="width: 28%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th>欄位</th>
<th>名稱</th>
<th>說明</th>
<th>意義 / QC 用途</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>chrom</strong></td>
<td>染色體 / contig 名稱</td>
<td>參考序列名稱</td>
<td>用來檢查 contig 是否異常或有污染</td>
</tr>
<tr class="even">
<td><strong>length</strong></td>
<td>序列長度</td>
<td>該 chromosome 在參考序列中的大小</td>
<td>檢查 reference build 是否一致</td>
</tr>
<tr class="odd">
<td><strong>mapped</strong></td>
<td>成功比對到該染色體的 reads 數量</td>
<td>染色體層級 mapping 數</td>
<td>mapping 是否均勻；chrM 是否過高</td>
</tr>
<tr class="even">
<td><strong>unmapped</strong></td>
<td>比對失敗但位於此條目的 reads</td>
<td>代表某些 read 無法比對</td>
<td>unmapped 太多可能是污染或品質差</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="samtools-stats" class="level1" data-number="13">
<h1 data-number="13"><span class="header-section-number">13</span> samtools stats</h1>
<p>samtools stats 是 最完整的 mapping 統計，提供： mapping 深度、read 長度分布、GC 分布、按距離區分的 insert size 分布、mismatch / error rate 與 per-chromosome 統計</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> stats ../.test/ex1.sorted.bam <span class="kw">|</span> <span class="fu">head</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code># This file was produced by samtools stats (1.23+htslib-1.23) and can be plotted using plot-bamstats
# This file contains statistics for all reads.
# The command line was:  stats ../.test/ex1.sorted.bam
# CHK, Checksum [2]Read Names   [3]Sequences    [4]Qualities
# CHK, CRC32 of reads which passed filtering followed by addition (32bit overflow)
CHK 1eb1426c    9b48daa9    abfd29ac
# Summary Numbers. Use `grep ^SN | cut -f 2-` to extract this part.
SN  raw total sequences:    3307    # excluding supplementary and secondary reads
SN  filtered sequences: 0
SN  sequences:  3307</code></pre>
</div>
</div>
<table class="caption-top table">
<colgroup>
<col style="width: 41%">
<col style="width: 21%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th>欄位</th>
<th>說明</th>
<th>意義 / QC 用途</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>raw total sequences</strong></td>
<td>原始讀序數量</td>
<td>檢查整體資料量是否足夠</td>
</tr>
<tr class="even">
<td><strong>filtered sequences</strong></td>
<td>被 filter 掉的 reads</td>
<td>若 &gt;0 → 上游 pipeline 有過濾步驟</td>
</tr>
<tr class="odd">
<td><strong>sequences</strong></td>
<td>參與比對的 reads</td>
<td>通常 = raw total - filtered</td>
</tr>
<tr class="even">
<td><strong>is sorted</strong></td>
<td>BAM 是否已排序</td>
<td>GATK / bcftools pipeline 必須為 1</td>
</tr>
<tr class="odd">
<td><strong>average length</strong></td>
<td>read 平均長度</td>
<td>檢查是否符合平台（Illumina 150bp）</td>
</tr>
<tr class="even">
<td><strong>average quality</strong></td>
<td>base quality 平均值</td>
<td>&lt;30 可能是低品質序列</td>
</tr>
<tr class="odd">
<td><strong>insert size average</strong></td>
<td>插入片段長度</td>
<td>WES/WGS 中非常關鍵</td>
</tr>
<tr class="even">
<td><strong>insert size standard deviation</strong></td>
<td>插入長度變異</td>
<td>變異大 → library 不均勻</td>
</tr>
<tr class="odd">
<td><strong>average depth</strong></td>
<td>整體平均深度</td>
<td>判斷是否達到 WGS 30X / WES 100X</td>
</tr>
<tr class="even">
<td><strong>error rate</strong></td>
<td>mismatches / bases</td>
<td>高 error rate → 可能污染</td>
</tr>
</tbody>
</table>
<hr>
</section>
<section id="samtools-help" class="level1" data-number="14">
<h1 data-number="14"><span class="header-section-number">14</span> samtools –help</h1>
<p>顯示 samtools 提供的主要參數與使用說明，適合作為快速查詢指令用途。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="ex">samtools</span> <span class="at">--help</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Program: samtools (Tools for alignments in the SAM format)
Version: 1.23 (using htslib 1.23)

Usage:   samtools &lt;command&gt; [options]

Commands:
  -- Indexing
     dict           create a sequence dictionary file
     faidx          index/extract FASTA
     fqidx          index/extract FASTQ
     index          index alignment

  -- Editing
     calmd          recalculate MD/NM tags and '=' bases
     fixmate        fix mate information
     reheader       replace BAM header
     targetcut      cut fosmid regions (for fosmid pool only)
     addreplacerg   adds or replaces RG tags
     markdup        mark duplicates
     ampliconclip   clip oligos from the end of reads

  -- File operations
     collate        shuffle and group alignments by name
     cat            concatenate BAMs
     consensus      produce a consensus Pileup/FASTA/FASTQ
     merge          merge sorted alignments
     mpileup        multi-way pileup
     sort           sort alignment file
     split          splits a file by read group
     quickcheck     quickly check if SAM/BAM/CRAM file appears intact
     fastq          converts a BAM to a FASTQ
     fasta          converts a BAM to a FASTA
     import         Converts FASTA or FASTQ files to SAM/BAM/CRAM
     reference      Generates a reference from aligned data
     reset          Reverts aligner changes in reads

  -- Statistics
     bedcov         read depth per BED region
     coverage       alignment depth and percent coverage
     depth          compute the depth
     flagstat       simple stats
     idxstats       BAM index stats
     cram-size      list CRAM Content-ID and Data-Series sizes
     phase          phase heterozygotes
     stats          generate stats (former bamcheck)
     ampliconstats  generate amplicon specific stats
     checksum       produce order-agnostic checksums of sequence content

  -- Viewing
     flags          explain BAM flags
     head           header viewer
     tview          text alignment viewer
     view           SAM&lt;-&gt;BAM&lt;-&gt;CRAM conversion
     depad          convert padded BAM to unpadded BAM
     samples        list the samples in a set of SAM/BAM/CRAM files

  -- Misc
     help [cmd]     display this help message or help for [cmd]
     version        detailed version information</code></pre>
</div>
</div>
<hr>
</section>
<section id="conda-環境資訊" class="level1" data-number="15">
<h1 data-number="15"><span class="header-section-number">15</span> Conda 環境資訊</h1>
<p>完整記錄當前執行的 Conda 環境，有助於分析重現、版本追蹤與錯誤排查。</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"======================================="</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"Conda Environment: </span><span class="va">$(</span><span class="ex">mamba</span> env list <span class="kw">|</span> <span class="fu">grep</span> <span class="st">'*'</span> <span class="kw">|</span> <span class="fu">awk</span> <span class="st">'{print $1}'</span><span class="va">)</span><span class="st">"</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="bu">echo</span> <span class="st">"======================================="</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="ex">conda</span> list</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>=======================================
Conda Environment: bio-tools
=======================================
# packages in environment at /home/benson/miniforge3/envs/bio-tools:
#
# Name                       Version            Build                 Channel
_libgcc_mutex                0.1                conda_forge           conda-forge
_openmp_mutex                4.5                2_gnu                 conda-forge
_python_abi3_support         1.0                hd8ed1ab_2            conda-forge
_r-mutex                     1.0.1              anacondar_1           conda-forge
alsa-lib                     1.2.15.1           hb03c661_0            conda-forge
annotated-types              0.7.0              pyhd8ed1ab_1          conda-forge
attrs                        25.4.0             pyhcf101f3_1          conda-forge
backports.zstd               1.2.0              py314h680f03e_0       conda-forge
bcftools                     1.23               h3a4d415_0            bioconda
bedtools                     2.31.1             h13024bc_3            bioconda
binutils_impl_linux-64       2.45               default_hfdba357_105  conda-forge
brotli-python                1.2.0              py314h3de4e8d_1       conda-forge
bwidget                      1.10.1             ha770c72_1            conda-forge
bzip2                        1.0.8              hda65f42_8            conda-forge
c-ares                       1.34.6             hb03c661_0            conda-forge
ca-certificates              2025.11.12         hbd8a1cb_0            conda-forge
cairo                        1.18.4             h3394656_0            conda-forge
certifi                      2025.11.12         pyhd8ed1ab_0          conda-forge
charset-normalizer           3.4.4              pyhd8ed1ab_0          conda-forge
click                        8.3.1              pyh8f84b5b_1          conda-forge
colorama                     0.4.6              pyhd8ed1ab_1          conda-forge
coloredlogs                  15.0.1             pyhd8ed1ab_4          conda-forge
colormath                    3.0.0              pyhd8ed1ab_4          conda-forge
cpython                      3.14.2             py314hd8ed1ab_100     conda-forge
curl                         8.17.0             h4e3cde8_1            conda-forge
dart-sass                    1.59.1             ha770c72_0            conda-forge
deno                         2.3.1              hbf66b88_0            conda-forge
deno-dom                     0.1.41             h4768de7_0            conda-forge
esbuild                      0.27.2             hfc2019e_0            conda-forge
expat                        2.7.3              hecca717_0            conda-forge
fastp                        1.0.1              heae3180_0            bioconda
fastqc                       0.12.1             hdfd78af_0            bioconda
font-ttf-dejavu-sans-mono    2.37               hab24e00_0            conda-forge
font-ttf-inconsolata         3.000              h77eed37_0            conda-forge
font-ttf-source-code-pro     2.038              h77eed37_0            conda-forge
font-ttf-ubuntu              0.83               h77eed37_3            conda-forge
fontconfig                   2.15.0             h7e30c49_1            conda-forge
fonts-conda-ecosystem        1                  0                     conda-forge
fonts-conda-forge            1                  hc364b38_1            conda-forge
freetype                     2.14.1             ha770c72_0            conda-forge
fribidi                      1.0.16             hb03c661_0            conda-forge
gcc_impl_linux-64            15.2.0             hc5723f1_16           conda-forge
gfortran_impl_linux-64       15.2.0             h281d09f_16           conda-forge
giflib                       5.2.2              hd590300_0            conda-forge
graphite2                    1.3.14             hecca717_2            conda-forge
gsl                          2.7                he838d99_0            conda-forge
gxx_impl_linux-64            15.2.0             hda75c37_16           conda-forge
h2                           4.3.0              pyhcf101f3_0          conda-forge
harfbuzz                     11.0.0             h76408a6_0            conda-forge
hpack                        4.1.0              pyhd8ed1ab_0          conda-forge
htslib                       1.23               h566b1c6_0            bioconda
humanfriendly                10.0               pyh707e725_8          conda-forge
humanize                     4.15.0             pyhd8ed1ab_0          conda-forge
hyperframe                   6.1.0              pyhd8ed1ab_0          conda-forge
icu                          75.1               he02047a_0            conda-forge
idna                         3.11               pyhd8ed1ab_0          conda-forge
importlib-metadata           8.7.0              pyhe01879c_1          conda-forge
isa-l                        2.31.1             hb9d3cd8_1            conda-forge
jinja2                       3.1.6              pyhcf101f3_1          conda-forge
jsonschema                   4.25.1             pyhe01879c_0          conda-forge
jsonschema-specifications    2025.9.1           pyhcf101f3_0          conda-forge
kaleido-core                 0.2.1              h3644ca4_0            conda-forge
kernel-headers_linux-64      5.14.0             he073ed8_3            conda-forge
keyutils                     1.6.3              hb9d3cd8_0            conda-forge
krb5                         1.21.3             h659f571_0            conda-forge
lcms2                        2.17               h717163a_0            conda-forge
ld_impl_linux-64             2.45               default_hbd61a6d_105  conda-forge
lerc                         4.0.0              h0aef613_1            conda-forge
libblas                      3.11.0             5_h4a7cf45_openblas   conda-forge
libcblas                     3.11.0             5_h0358290_openblas   conda-forge
libcups                      2.3.3              hb8b1518_5            conda-forge
libcurl                      8.17.0             h4e3cde8_1            conda-forge
libdeflate                   1.22               hb9d3cd8_0            conda-forge
libedit                      3.1.20250104       pl5321h7949ede_0      conda-forge
libev                        4.33               hd590300_2            conda-forge
libexpat                     2.7.3              hecca717_0            conda-forge
libffi                       3.5.2              h9ec8514_0            conda-forge
libfreetype                  2.14.1             ha770c72_0            conda-forge
libfreetype6                 2.14.1             h73754d4_0            conda-forge
libgcc                       15.2.0             he0feb66_16           conda-forge
libgcc-devel_linux-64        15.2.0             hcc6f6b0_116          conda-forge
libgcc-ng                    15.2.0             h69a702a_16           conda-forge
libgfortran                  15.2.0             h69a702a_16           conda-forge
libgfortran-ng               15.2.0             h69a702a_16           conda-forge
libgfortran5                 15.2.0             h68bc16d_16           conda-forge
libglib                      2.84.0             h2ff4ddf_0            conda-forge
libgomp                      15.2.0             he0feb66_16           conda-forge
libiconv                     1.18               h3b78370_2            conda-forge
libjpeg-turbo                3.1.2              hb03c661_0            conda-forge
liblapack                    3.11.0             5_h47877c9_openblas   conda-forge
liblzma                      5.8.1              hb9d3cd8_2            conda-forge
libmpdec                     4.0.0              hb9d3cd8_0            conda-forge
libnghttp2                   1.67.0             had1ee68_0            conda-forge
libopenblas                  0.3.30             pthreads_h94d23a6_4   conda-forge
libpng                       1.6.53             h421ea60_0            conda-forge
libsanitizer                 15.2.0             h90f66d4_16           conda-forge
libsqlite                    3.51.1             h0c1763c_1            conda-forge
libssh2                      1.11.1             hcf80075_0            conda-forge
libstdcxx                    15.2.0             h934c35e_16           conda-forge
libstdcxx-devel_linux-64     15.2.0             hd446a21_116          conda-forge
libstdcxx-ng                 15.2.0             hdf11a46_16           conda-forge
libtiff                      4.7.0              hc4654cb_2            conda-forge
libuuid                      2.41.3             h5347b49_0            conda-forge
libuv                        1.51.0             hb03c661_1            conda-forge
libwebp-base                 1.6.0              hd42ef1d_0            conda-forge
libxcb                       1.17.0             h8a09558_0            conda-forge
libxcrypt                    4.4.36             hd590300_1            conda-forge
libzlib                      1.3.1              hb9d3cd8_2            conda-forge
make                         4.4.1              hb9d3cd8_2            conda-forge
markdown                     3.10               pyhcf101f3_1          conda-forge
markdown-it-py               4.0.0              pyhd8ed1ab_0          conda-forge
markupsafe                   3.0.3              pyh7db6752_0          conda-forge
mathjax                      2.7.7              ha770c72_3            conda-forge
mdurl                        0.1.2              pyhd8ed1ab_1          conda-forge
multiqc                      1.33               pyhdfd78af_0          bioconda
narwhals                     2.14.0             pyhcf101f3_0          conda-forge
natsort                      8.4.0              pyh29332c3_1          conda-forge
ncurses                      6.5                h2d0b736_3            conda-forge
networkx                     3.6.1              pyhcf101f3_0          conda-forge
nodejs                       22.21.1            h4a9c4b4_0            conda-forge
nspr                         4.38               h29cc59b_0            conda-forge
nss                          3.118              h445c969_0            conda-forge
numpy                        2.4.0              py314h2b28147_0       conda-forge
openjdk                      23.0.2             h53dfc1b_2            conda-forge
openjpeg                     2.5.3              h55fea9a_1            conda-forge
openssl                      3.6.0              h26f9b46_0            conda-forge
packaging                    25.0               pyh29332c3_1          conda-forge
pandoc                       3.6.3              ha770c72_0            conda-forge
pango                        1.56.3             h9ac818e_1            conda-forge
pcre2                        10.44              hc749103_2            conda-forge
perl                         5.32.1             7_hd590300_perl5      conda-forge
pillow                       11.3.0             py314hdf18abd_3       conda-forge
pip                          25.3               pyh145f28c_0          conda-forge
pixman                       0.46.4             h54a6638_1            conda-forge
plotly                       6.5.0              pyhd8ed1ab_0          conda-forge
polars                       1.36.1             pyh6a1acc5_0          conda-forge
polars-lts-cpu               1.34.0.deprecated  hc364b38_0            conda-forge
polars-runtime-32            1.36.1             py310hffdcd12_0       conda-forge
polars-runtime-compat        1.36.1             py310hbcd5346_0       conda-forge
pthread-stubs                0.4                hb9d3cd8_1002         conda-forge
pyaml-env                    1.2.2              pyhd8ed1ab_0          conda-forge
pydantic                     2.12.5             pyhcf101f3_1          conda-forge
pydantic-core                2.41.5             py314h2e6c369_1       conda-forge
pygments                     2.19.2             pyhd8ed1ab_0          conda-forge
pysocks                      1.7.1              pyha55dd90_7          conda-forge
python                       3.14.2             h32b2ec7_100_cp314    conda-forge
python-dotenv                1.2.1              pyhcf101f3_0          conda-forge
python-gil                   3.14.2             h4df99d1_100          conda-forge
python-kaleido               0.2.1              pyhd8ed1ab_0          conda-forge
python_abi                   3.14               8_cp314               conda-forge
pyyaml                       6.0.3              pyh7db6752_0          conda-forge
quarto                       1.8.26             hbf95b10_0            conda-forge
r-base                       4.4.2              hbab086e_1            conda-forge
r-base64enc                  0.1_3              r44h54b55ab_1008      conda-forge
r-bslib                      0.9.0              r44hc72bb7e_1         conda-forge
r-cachem                     1.1.0              r44h54b55ab_2         conda-forge
r-cli                        3.6.5              r44h3697838_1         conda-forge
r-digest                     0.6.39             r44h3697838_0         conda-forge
r-ellipsis                   0.3.2              r44h54b55ab_4         conda-forge
r-evaluate                   1.0.5              r44hc72bb7e_1         conda-forge
r-fastmap                    1.2.0              r44h3697838_2         conda-forge
r-fontawesome                0.5.3              r44hc72bb7e_1         conda-forge
r-fs                         1.6.6              r44h3697838_1         conda-forge
r-glue                       1.8.0              r44h54b55ab_1         conda-forge
r-here                       1.0.2              r44hc72bb7e_0         conda-forge
r-highr                      0.11               r44hc72bb7e_2         conda-forge
r-htmltools                  0.5.9              r44h3697838_0         conda-forge
r-jquerylib                  0.1.4              r44hc72bb7e_4         conda-forge
r-jsonlite                   2.0.0              r44h54b55ab_1         conda-forge
r-knitr                      1.51               r44hc72bb7e_0         conda-forge
r-lattice                    0.22_7             r44h54b55ab_1         conda-forge
r-lifecycle                  1.0.4              r44hc72bb7e_2         conda-forge
r-matrix                     1.7_4              r44h0e4624f_1         conda-forge
r-memoise                    2.0.1              r44hc72bb7e_4         conda-forge
r-mime                       0.13               r44h54b55ab_1         conda-forge
r-png                        0.1_8              r44h6b2d295_3         conda-forge
r-r6                         2.6.1              r44hc72bb7e_1         conda-forge
r-rappdirs                   0.3.3              r44h54b55ab_4         conda-forge
r-rcpp                       1.1.0              r44h3697838_1         conda-forge
r-rcpptoml                   0.2.3              r44h3697838_1         conda-forge
r-reticulate                 1.44.1             r44h3697838_0         conda-forge
r-rlang                      1.1.6              r44h3697838_1         conda-forge
r-rmarkdown                  2.30               r44hc72bb7e_0         conda-forge
r-rprojroot                  2.1.1              r44hc72bb7e_1         conda-forge
r-sass                       0.4.10             r44h3697838_1         conda-forge
r-tinytex                    0.58               r44hc72bb7e_0         conda-forge
r-withr                      3.0.2              r44hc72bb7e_1         conda-forge
r-xfun                       0.55               r44h3697838_0         conda-forge
r-yaml                       2.3.12             r44h54b55ab_0         conda-forge
readline                     8.3                h853b02a_0            conda-forge
referencing                  0.37.0             pyhcf101f3_0          conda-forge
regex                        2025.11.3          py314h5bd0f2a_1       conda-forge
requests                     2.32.5             pyhd8ed1ab_0          conda-forge
rich                         14.2.0             pyhcf101f3_0          conda-forge
rich-click                   1.9.5              pyhd8ed1ab_0          conda-forge
rpds-py                      0.30.0             py314h2e6c369_0       conda-forge
samtools                     1.23               h96c455f_0            bioconda
sed                          4.9                h6688a6e_0            conda-forge
seqtk                        1.5                h577a1d6_1            bioconda
spectra                      0.0.11             pyhd8ed1ab_2          conda-forge
sqlite                       3.51.1             hbc0de68_1            conda-forge
sysroot_linux-64             2.34               h087de78_3            conda-forge
tiktoken                     0.12.0             py314h67fec18_3       conda-forge
tk                           8.6.13             noxft_ha0e22de_103    conda-forge
tktable                      2.10               h8d826fa_7            conda-forge
tqdm                         4.67.1             pyhd8ed1ab_1          conda-forge
typeguard                    4.4.4              pyhd8ed1ab_0          conda-forge
typing-extensions            4.15.0             h396c80c_0            conda-forge
typing-inspection            0.4.2              pyhd8ed1ab_1          conda-forge
typing_extensions            4.15.0             pyhcf101f3_0          conda-forge
typst                        0.13.0             h53e704d_0            conda-forge
tzdata                       2025c              h8577fbf_0            conda-forge
urllib3                      2.6.2              pyhd8ed1ab_0          conda-forge
vcftools                     0.1.17             pl5321h077b44d_0      bioconda
xorg-libice                  1.1.2              hb9d3cd8_0            conda-forge
xorg-libsm                   1.2.6              he73a12e_0            conda-forge
xorg-libx11                  1.8.12             h4f16b4b_0            conda-forge
xorg-libxau                  1.0.12             hb03c661_1            conda-forge
xorg-libxdmcp                1.1.5              hb03c661_1            conda-forge
xorg-libxext                 1.3.6              hb9d3cd8_0            conda-forge
xorg-libxfixes               6.0.2              hb03c661_0            conda-forge
xorg-libxi                   1.8.2              hb9d3cd8_0            conda-forge
xorg-libxrandr               1.5.4              hb9d3cd8_0            conda-forge
xorg-libxrender              0.9.12             hb9d3cd8_0            conda-forge
xorg-libxt                   1.3.1              hb9d3cd8_0            conda-forge
xorg-libxtst                 1.2.5              hb9d3cd8_3            conda-forge
yaml                         0.2.5              h280c20c_3            conda-forge
zipp                         3.23.0             pyhcf101f3_1          conda-forge
zstd                         1.5.7              hb78ec9c_6            conda-forge</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>