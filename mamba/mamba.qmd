---
title: "mamba 基本使用"
date: today
date-format: "YYYY-MM-DD"
format:
  html:
    toc: true
    toc-title: Contents
    toc-location: left
    toc-depth: 4
    toc-expand: 1
    css: ../styles/quarto.css
    other-links:
      - text: home
        icon: house
        href: https://benson1231.github.io/tools/
    code-links:
      - text: github
        icon: github
        href: https://github.com/benson1231/tools
number-sections: true
engine: knitr
---

# mamba 介紹

> 現代生物資訊工作流程（特別是 nf-core）已全面建議使用 mamba 取代 conda 進行求解，沒接觸過 conda 的人可參閱 [conda教學](../conda/conda.html)。

mamba 是一個高效、與 conda 完全相容的套件與環境管理工具，由 QuantStack 開發。它的目標是提供比 conda **更快、更穩定、更具可預測性**的套件求解（dependency solving）能力，同時保留所有 conda 的使用方式與指令格式。

## 為什麼需要 mamba？

傳統的 conda 在進行環境建立或安裝套件時，常因依賴衝突（dependency conflicts）導致求解時間很長（數分鐘到數十分鐘）

mamba 使用 **C++ 實作的高速依賴求解器（libsolv）**，大幅提升速度與穩定性，使許多原本需要 1–10 分鐘的 conda 操作縮短到 **數秒完成**。

| 功能              | conda            | mamba                         |
| --------------- | ---------------- | ----------------------------- |
| 依賴求解速度          | 慢（Python solver） | **極快（libsolv）**               |
| 下載方式            | 單線程              | **多線程並行下載**                   |
| 相容性             | 完全支援             | **100% 相容 conda**             |
| 生信 pipeline 推薦度 | 普通               | **強烈推薦（nf-core / Snakemake）** |

## mamba 的核心特色

- 超高速的依賴求解器
- 與 conda 指令相同，僅需將 `conda` 換成 `mamba`
- 支援與 conda 共存（Miniforge 已預設內建 mamba）
- 多線程下載（parallel downloads）
- 更清楚的錯誤訊息

# mamba 安裝（直接安裝 Miniforge）

直接安裝 [Miniforge](https://github.com/conda-forge/miniforge)，即包含 mamba，也可查閱 [mamba 官方下載指南](https://mamba.readthedocs.io/en/latest/installation/mamba-installation.html)

# mamba --version (版本)

使用 `--version` 參數確認 conda 是否成功安裝，並顯示版本號。

```{bash}
mamba --version
```

# mamba create (建立環境)

`-n` 代表創建環境名稱， `-y` 代表直接確認下載 (yes)

```bash
mamba create -n myenv python=3.10 -y
```

# mamba activate (啟動環境)

```bash
mamba activate myenv
```

# mamba install (安裝套件)

```bash
mamba install numpy -y
```

# mamba remove (移除套件)

```bash
mamba remove numpy -y
```

# mamba deactivate (離開環境)

```bash
mamba deactivate
```

# mamba env (環境相關指令)

查看環境相關指令

```{bash}
mamba env --help
```

## mamba env export (匯出環境YAML)

```bash
mamba env export > output.yaml
```

## mamba env create (由YAML檔建立環境)

`-f` 指定檔名，創建環境名稱為 YAML 中 `name 參數`

```bash
mamba env create -f ./mamba/mamba-envs.yaml -y
```

## mamba env remove (刪除環境)

```bash
mamba env remove -n myenv -y
```

## mamba env list (列出所有環境)

`*` 為目前環境

```{bash}
mamba env list
```

# mamba list

列出套件相關資源

## mamba list (查看套件來源)

```{bash}
mamba list
```

## mamba list --explicit (詳細套件url)

列出詳細 url

```{bash}
mamba list --explicit
```

# 環境資訊

完整記錄當前執行的 Conda 環境，有助於分析重現、版本追蹤與錯誤排查。

```{bash}
echo "======================================="
echo "Mamba Environment: $(mamba env list | grep '*' | awk '{print $1}')"
echo "======================================="
mamba list
```

# mamba --help

顯示 mamba 的主要參數與使用說明，適合作為快速查詢用途。

```{bash}
mamba --help
```