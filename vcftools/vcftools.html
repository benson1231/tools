<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.26">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-12-29">

<title>vcftools 基本使用</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="vcftools_files/libs/clipboard/clipboard.min.js"></script>
<script src="vcftools_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="vcftools_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="vcftools_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="vcftools_files/libs/quarto-html/popper.min.js"></script>
<script src="vcftools_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="vcftools_files/libs/quarto-html/anchor.min.js"></script>
<link href="vcftools_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="vcftools_files/libs/quarto-html/quarto-syntax-highlighting-587c61ba64f3a5504c4d52d930310e48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="vcftools_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="vcftools_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="vcftools_files/libs/bootstrap/bootstrap-10fe2bd9fd8498839a96d31d92c830c0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


<link rel="stylesheet" href="../styles/quarto.css">
</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="1">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#vcftools-介紹" id="toc-vcftools-介紹" class="nav-link active" data-scroll-target="#vcftools-介紹"><span class="header-section-number">1</span> vcftools 介紹</a></li>
  <li><a href="#vcftools-version-版本" id="toc-vcftools-version-版本" class="nav-link" data-scroll-target="#vcftools-version-版本"><span class="header-section-number">2</span> vcftools –version (版本)</a></li>
  <li><a href="#vcftools-基本指令" id="toc-vcftools-基本指令" class="nav-link" data-scroll-target="#vcftools-基本指令"><span class="header-section-number">3</span> vcftools 基本指令</a></li>
  <li><a href="#vcftools-過濾" id="toc-vcftools-過濾" class="nav-link" data-scroll-target="#vcftools-過濾"><span class="header-section-number">4</span> vcftools 過濾</a>
  <ul>
  <li><a href="#過濾位置" id="toc-過濾位置" class="nav-link" data-scroll-target="#過濾位置"><span class="header-section-number">4.1</span> 過濾位置</a></li>
  <li><a href="#過濾位點id" id="toc-過濾位點id" class="nav-link" data-scroll-target="#過濾位點id"><span class="header-section-number">4.2</span> 過濾位點ID</a></li>
  <li><a href="#過濾變異類型" id="toc-過濾變異類型" class="nav-link" data-scroll-target="#過濾變異類型"><span class="header-section-number">4.3</span> 過濾變異類型</a></li>
  <li><a href="#過濾filter欄位資訊" id="toc-過濾filter欄位資訊" class="nav-link" data-scroll-target="#過濾filter欄位資訊"><span class="header-section-number">4.4</span> 過濾FILTER欄位資訊</a></li>
  <li><a href="#過濾info欄位" id="toc-過濾info欄位" class="nav-link" data-scroll-target="#過濾info欄位"><span class="header-section-number">4.5</span> 過濾INFO欄位</a></li>
  <li><a href="#過濾等位基因" id="toc-過濾等位基因" class="nav-link" data-scroll-target="#過濾等位基因"><span class="header-section-number">4.6</span> 過濾等位基因</a></li>
  <li><a href="#過濾基因型層級" id="toc-過濾基因型層級" class="nav-link" data-scroll-target="#過濾基因型層級"><span class="header-section-number">4.7</span> 過濾基因型層級</a></li>
  <li><a href="#過濾品質" id="toc-過濾品質" class="nav-link" data-scroll-target="#過濾品質"><span class="header-section-number">4.8</span> 過濾品質</a></li>
  <li><a href="#樣本過濾" id="toc-樣本過濾" class="nav-link" data-scroll-target="#樣本過濾"><span class="header-section-number">4.9</span> 樣本過濾</a></li>
  </ul></li>
  <li><a href="#vcftools-輸出選項" id="toc-vcftools-輸出選項" class="nav-link" data-scroll-target="#vcftools-輸出選項"><span class="header-section-number">5</span> vcftools 輸出選項</a>
  <ul>
  <li><a href="#等位基因統計" id="toc-等位基因統計" class="nav-link" data-scroll-target="#等位基因統計"><span class="header-section-number">5.1</span> 等位基因統計</a></li>
  <li><a href="#深度統計" id="toc-深度統計" class="nav-link" data-scroll-target="#深度統計"><span class="header-section-number">5.2</span> 深度統計</a></li>
  <li><a href="#連鎖不平衡-ld" id="toc-連鎖不平衡-ld" class="nav-link" data-scroll-target="#連鎖不平衡-ld"><span class="header-section-number">5.3</span> 連鎖不平衡 LD</a>
  <ul class="collapse">
  <li><a href="#ld-計算範圍控制" id="toc-ld-計算範圍控制" class="nav-link" data-scroll-target="#ld-計算範圍控制"><span class="header-section-number">5.3.1</span> LD 計算範圍控制</a></li>
  </ul></li>
  <li><a href="#transitiontransversion-statistics" id="toc-transitiontransversion-statistics" class="nav-link" data-scroll-target="#transitiontransversion-statistics"><span class="header-section-number">5.4</span> Transition/Transversion Statistics</a></li>
  <li><a href="#核苷酸多樣性-π" id="toc-核苷酸多樣性-π" class="nav-link" data-scroll-target="#核苷酸多樣性-π"><span class="header-section-number">5.5</span> 核苷酸多樣性 π</a></li>
  <li><a href="#fst-statistics族群遺傳分化" id="toc-fst-statistics族群遺傳分化" class="nav-link" data-scroll-target="#fst-statistics族群遺傳分化"><span class="header-section-number">5.6</span> Fst Statistics（族群遺傳分化）</a></li>
  <li><a href="#其他分析統計" id="toc-其他分析統計" class="nav-link" data-scroll-target="#其他分析統計"><span class="header-section-number">5.7</span> 其他分析統計</a></li>
  <li><a href="#output-formatinfo-extraction擷取格式或info欄位置" id="toc-output-formatinfo-extraction擷取格式或info欄位置" class="nav-link" data-scroll-target="#output-formatinfo-extraction擷取格式或info欄位置"><span class="header-section-number">5.8</span> Output FORMAT/INFO Extraction（擷取格式或INFO欄位置）</a></li>
  <li><a href="#output-vcfbcf重新編碼輸出" id="toc-output-vcfbcf重新編碼輸出" class="nav-link" data-scroll-target="#output-vcfbcf重新編碼輸出"><span class="header-section-number">5.9</span> Output VCF/BCF（重新編碼輸出）</a></li>
  <li><a href="#other-format-outputs轉換為其他格式" id="toc-other-format-outputs轉換為其他格式" class="nav-link" data-scroll-target="#other-format-outputs轉換為其他格式"><span class="header-section-number">5.10</span> Other Format Outputs（轉換為其他格式）</a></li>
  </ul></li>
  <li><a href="#vcf檔案比較" id="toc-vcf檔案比較" class="nav-link" data-scroll-target="#vcf檔案比較"><span class="header-section-number">6</span> VCF檔案比較</a></li>
  <li><a href="#man-vcftools" id="toc-man-vcftools" class="nav-link" data-scroll-target="#man-vcftools"><span class="header-section-number">7</span> man vcftools</a></li>
  </ul>
<div class="quarto-other-links"><h2>Other Links</h2><ul><li><a href="https://benson1231.github.io/tools/"><i class="bi bi-house"></i>home</a></li></ul></div><div class="quarto-code-links"><h2>Code Links</h2><ul><li><a href="https://github.com/benson1231/tools"><i class="bi bi-github"></i>github</a></li></ul></div></nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">vcftools 基本使用</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">2025-12-29</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="vcftools-介紹" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> vcftools 介紹</h1>
<p><a href="https://github.com/vcftools/vcftools">VCFtools</a> 是一套專門用於處理與分析 VCF（Variant Call Format） 的指令列工具集 <a href="https://vcftools.github.io/man_latest.html">(見詳細官方文檔)</a>，由 Adam Auton, Anthony Marcketta 與 Petr Danecek 於 2009 年開發。VCF 是目前基因體變異資料的主要交換格式，而 VCFtools 提供一系列常用功能，可用於檢查、篩選、轉換與統計變異資料，是變異分析流程中最經典、最常見的工具之一。</p>
<p>VCFtools 的核心概念非常簡單： 讀入一個 VCF → 依選項進行篩選或統計 → 輸出結果。 它不會重新呼叫 variants，而是協助使用者快速檢查變異品質、過濾特定條件的變異，或輸出 QC 所需的統計指標。</p>
<blockquote class="blockquote">
<p>` The Variant Call Format and VCFtools, Petr Danecek, Adam Auton, Goncalo Abecasis, Cornelis A. Albers, Eric Banks, Mark A. DePristo, Robert Handsaker, Gerton Lunter, Gabor Marth, Stephen T. Sherry, Gilean McVean, Richard Durbin and 1000 Genomes Project Analysis Group, Bioinformatics, 2011 http://dx.doi.org/10.1093/bioinformatics/btr330</p>
</blockquote>
<hr>
</section>
<section id="vcftools-version-版本" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> vcftools –version (版本)</h1>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vcftools</span> <span class="at">--version</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>VCFtools (0.1.16)</code></pre>
</div>
</div>
<hr>
</section>
<section id="vcftools-基本指令" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> vcftools 基本指令</h1>
<p>以下為基本指令，vcftools 統一使用 <code>--指令</code> 的方式設定參數，首先需要給輸入與輸出:</p>
<ul>
<li><p><strong><code>--vcf &lt;輸入檔名&gt;</code></strong>: VCF 格式 v4.0、v4.1 或 v4.2 的檔案</p></li>
<li><p><strong><code>--gzvcf &lt;輸入檔名&gt;</code></strong>: 壓縮（gzip 壓縮）的 VCF 檔案</p></li>
<li><p><strong><code>--bcf &lt;輸入檔名&gt;</code></strong>: 直接讀取 BCF2 檔案</p></li>
<li><p><strong><code>--out &lt;輸出前綴&gt;</code></strong></p></li>
<li><p><strong><code>--stdout 或 -c</code></strong>: 定向到標準輸出</p></li>
<li><p><strong><code>--temp &lt;暫存目錄&gt;</code></strong>: 建立的任何暫存檔案重定向到指定目錄</p></li>
</ul>
<p>基礎指令如下:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb3"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">vcftools</span> [ <span class="at">--vcf</span> FILE <span class="kw">|</span> <span class="ex">--gzvcf</span> FILE <span class="kw">|</span> <span class="ex">--bcf</span> FILE] </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="bu">[</span> --out OUTPUT PREFIX <span class="bu">]</span> <span class="bu">[</span> FILTERING OPTIONS <span class="bu">]</span> <span class="bu">[</span> OUTPUT OPTIONS <span class="bu">]</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<hr>
</section>
<section id="vcftools-過濾" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> vcftools 過濾</h1>
<p>vcftools 可以透過各種 <code>--過濾指令</code> 過濾特定資訊</p>
<section id="過濾位置" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="過濾位置"><span class="header-section-number">4.1</span> 過濾位置</h2>
<ul>
<li><strong><code>--chr &lt;chromosome&gt;</code></strong>：只保留指定染色體的變異。可重複使用以包含多條染色體。</li>
<li><strong><code>--not-chr &lt;chromosome&gt;</code></strong>：排除指定染色體的變異。可重複使用以排除多條染色體。</li>
<li><strong><code>--from-bp &lt;integer&gt;</code></strong>：設定區間下界（bp）。需搭配 <code>--chr</code> 使用。</li>
<li><strong><code>--to-bp &lt;integer&gt;</code></strong>：設定區間上界（bp）。可單獨或與 <code>--from-bp</code> 一起使用。</li>
<li><strong><code>--positions &lt;filename&gt;</code></strong>：依據檔案中列出的 (chr, position) 清單保留位點。</li>
<li><strong><code>--exclude-positions &lt;filename&gt;</code></strong>：依據清單排除指定位置。</li>
<li><strong><code>--positions-overlap &lt;filename&gt;</code></strong>：保留 REF 等位基因「有重疊」指定位置的位點。</li>
<li><strong><code>--exclude-positions-overlap &lt;filename&gt;</code></strong>：排除 REF 與指定位置重疊的位點。</li>
<li><strong><code>--bed &lt;filename&gt;</code></strong>：依 BED 區域保留位點（REF 或 ALT 任一落入範圍即可）。</li>
<li><strong><code>--exclude-bed &lt;filename&gt;</code></strong>：依 BED 區域排除位點。</li>
<li><strong><code>--thin &lt;integer&gt;</code></strong>：對位點進行間距過濾，確保任兩個位點之間至少相隔指定距離（bp）。</li>
<li><strong><code>--mask &lt;filename&gt;</code></strong>：依 mask 檔（FASTA-like）中的數值決定保留或排除的位置。</li>
<li><strong><code>--invert-mask &lt;filename&gt;</code></strong>：反轉 mask 檔的選擇邏輯（0→排除、其他→保留）。</li>
<li><strong><code>--mask-min &lt;integer&gt;</code></strong>：設定保留的最小閾值，僅保留 mask 值 ≤ 該數字的位置（預設為 0）。</li>
</ul>
<hr>
</section>
<section id="過濾位點id" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="過濾位點id"><span class="header-section-number">4.2</span> 過濾位點ID</h2>
<ul>
<li><strong><code>--snp &lt;string&gt;</code></strong>：只保留具有指定 SNP ID（如 dbSNP rsID）之位點。可重複使用。</li>
<li><strong><code>--snps &lt;filename&gt;</code></strong>：依檔案中的 SNP ID 清單保留位點（每行一個 ID）。</li>
<li><strong><code>--exclude &lt;filename&gt;</code></strong>：依檔案中的 SNP ID 清單排除位點。</li>
</ul>
<hr>
</section>
<section id="過濾變異類型" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="過濾變異類型"><span class="header-section-number">4.3</span> 過濾變異類型</h2>
<ul>
<li><strong><code>--keep-only-indels</code></strong>：只保留含有 indel 的位點（REF 與 ALT 長度不同）。</li>
<li><strong><code>--remove-indels</code></strong>：排除所有 indel 位點，僅保留 SNP。</li>
</ul>
<hr>
</section>
<section id="過濾filter欄位資訊" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="過濾filter欄位資訊"><span class="header-section-number">4.4</span> 過濾FILTER欄位資訊</h2>
<ul>
<li><strong><code>--remove-filtered-all</code></strong>：移除所有 FILTER 標記不是 PASS 的位點。</li>
<li><strong><code>--keep-filtered &lt;string&gt;</code></strong>：只保留特定 FILTER 標記的位點（可多次使用）。</li>
<li><strong><code>--remove-filtered &lt;string&gt;</code></strong>：排除具有指定 FILTER 標記的位點（可多次使用）。</li>
</ul>
<hr>
</section>
<section id="過濾info欄位" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="過濾info欄位"><span class="header-section-number">4.5</span> 過濾INFO欄位</h2>
<ul>
<li><strong><code>--keep-INFO &lt;string&gt;</code></strong>：保留具有指定 INFO flag 的位點（僅依 flag 是否存在，不比較其值）。</li>
<li><strong><code>--remove-INFO &lt;string&gt;</code></strong>：排除具有特定 INFO flag 的位點。可重複使用。</li>
</ul>
<hr>
</section>
<section id="過濾等位基因" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="過濾等位基因"><span class="header-section-number">4.6</span> 過濾等位基因</h2>
<ul>
<li><strong><code>--maf &lt;float&gt;</code></strong>：只保留 Minor Allele Frequency ≥ 指定值的位點。</li>
<li><strong><code>--max-maf &lt;float&gt;</code></strong>：只保留 Minor Allele Frequency ≤ 指定值的位點。</li>
<li><strong><code>--non-ref-af &lt;float&gt;</code></strong>, <strong><code>--max-non-ref-af &lt;float&gt;</code></strong>：根據 ALT 等位基因頻率（全部 ALT 需符合門檻）。</li>
<li><strong><code>--non-ref-ac &lt;integer&gt;</code></strong>, <strong><code>--max-non-ref-ac &lt;integer&gt;</code></strong>：根據 ALT 等位基因計數做過濾（全部 ALT 需符合）。</li>
<li><strong><code>--non-ref-af-any &lt;float&gt;</code></strong>, <strong><code>--max-non-ref-af-any &lt;float&gt;</code></strong>：只要任一 ALT 等位基因符合條件即可保留。</li>
<li><strong><code>--non-ref-ac-any &lt;integer&gt;</code></strong>, <strong><code>--max-non-ref-ac-any &lt;integer&gt;</code></strong>：ALT 計數只要任一符合即可保留。</li>
<li><strong><code>--mac &lt;integer&gt;</code></strong>：Minor Allele Count ≥ 指定數值才保留該位點。</li>
<li><strong><code>--max-mac &lt;integer&gt;</code></strong>：Minor Allele Count ≤ 指定數值才保留該位點。</li>
<li><strong><code>--min-alleles &lt;integer&gt;</code></strong>：只保留等位基因數量 ≥ 指定值的位點。</li>
<li><strong><code>--max-alleles &lt;integer&gt;</code></strong>：只保留等位基因數量 ≤ 指定值的位點。</li>
</ul>
<hr>
</section>
<section id="過濾基因型層級" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="過濾基因型層級"><span class="header-section-number">4.7</span> 過濾基因型層級</h2>
<ul>
<li><strong><code>--min-meanDP &lt;float&gt;</code></strong> / <strong><code>--max-meanDP &lt;float&gt;</code></strong>：依平均深度篩選位點（需 FORMAT 中含 DP 欄位）。</li>
<li><strong><code>--hwe &lt;float&gt;</code></strong>：排除不符合 Hardy-Weinberg 平衡的位點（p-value 小於設定值）。</li>
<li><strong><code>--max-missing &lt;float&gt;</code></strong>：依缺失比例（0–1）過濾位點。</li>
<li><strong><code>--max-missing-count &lt;integer&gt;</code></strong>：排除缺失 genotypes 數量超過此值的位點。</li>
<li><strong><code>--phased</code></strong>：僅保留具有 phased（如 0|1）基因型的位點。</li>
</ul>
<hr>
</section>
<section id="過濾品質" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="過濾品質"><span class="header-section-number">4.8</span> 過濾品質</h2>
<ul>
<li><strong><code>--minQ &lt;float&gt;</code></strong>：只保留 QUAL 值 ≥ 指定 threshold 的位點。</li>
</ul>
<hr>
</section>
<section id="樣本過濾" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="樣本過濾"><span class="header-section-number">4.9</span> 樣本過濾</h2>
<p>這些選項用於 <strong>保留或排除特定樣本（individuals）</strong>，適用於任何基於樣本的分析，如 missingness、depth、HWE、Fst 等檢定。</p>
<ul>
<li><p><strong><code>--indv &lt;string&gt;</code></strong>：保留指定樣本。可多次使用以包含多個樣本。</p></li>
<li><p><strong><code>--remove-indv &lt;string&gt;</code></strong>：排除指定樣本。可多次使用以排除多個樣本。</p></li>
<li><p><strong><code>--keep &lt;filename&gt;</code></strong>：依檔案中的樣本清單保留樣本（每行一個樣本 ID）。</p></li>
<li><p><strong><code>--remove &lt;filename&gt;</code></strong>：依檔案中的樣本清單排除樣本。</p></li>
<li><p><strong><code>--max-indv &lt;integer&gt;</code></strong>：隨機保留指定數量的樣本，用於避免族群大小差異造成偏差。</p></li>
</ul>
<blockquote class="blockquote">
<p><code>若同時使用</code>–indv<code>與</code>–remove-indv<code>，會先執行</code>–indv<code>再執行</code>–remove-indv`。</p>
<p><code>若同時使用</code>–keep<code>與</code>–remove<code>：</code> <code>* 先執行</code>–keep<code></code> * 再從保留的集合中移除 <code>--remove</code> 的樣本 ` * 多個清單檔案會取「聯集」，再進行篩選</p>
</blockquote>
<hr>
</section>
</section>
<section id="vcftools-輸出選項" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> vcftools 輸出選項</h1>
<p>這些選項用於指定 <strong>vcftools 在完成所有篩選後要輸出哪些分析結果</strong>，涵蓋等位基因統計、深度、LD、Fst、Ts/Tv、missingness、ROH、relatedness、以及格式轉換等功能。</p>
<hr>
<section id="等位基因統計" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="等位基因統計"><span class="header-section-number">5.1</span> 等位基因統計</h2>
<ul>
<li><strong><code>--freq / --freq2**：輸出各位點的等位基因頻率（.frq）。</code></strong> :–freq2` 不輸出等位基因資訊。</li>
<li><strong><code>--counts / --counts2**：輸出等位基因計數（.frq.count）。</code></strong>: –counts2` 不輸出 allele 訊息。</li>
<li><strong><code>--derived</code></strong>：搭配 freq/count 重新排序等位基因，使 ancestral allele (AA) 在前。</li>
</ul>
<hr>
</section>
<section id="深度統計" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="深度統計"><span class="header-section-number">5.2</span> 深度統計</h2>
<ul>
<li><strong><code>--depth</code></strong>：每個樣本的平均深度（.idepth）。</li>
<li><strong><code>--site-depth</code></strong>：每個位點的總深度（.ldepth）。</li>
<li><strong><code>--site-mean-depth</code></strong>：每個位點的平均深度（.ldepth.mean）。</li>
<li><strong><code>--geno-depth</code></strong>：每個 genotype 的深度矩陣（.gdepth）。缺失以 -1 表示。</li>
</ul>
<hr>
</section>
<section id="連鎖不平衡-ld" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="連鎖不平衡-ld"><span class="header-section-number">5.3</span> 連鎖不平衡 LD</h2>
<ul>
<li><strong><code>--hap-r2</code></strong>：用 phased haplotypes 計算 r²、D、D’（.hap.ld）。</li>
<li><strong><code>--geno-r2</code></strong>：以 0/1/2 genotype 計算 r²（PLINK 方式）（.geno.ld）。</li>
<li><strong><code>--geno-chisq</code></strong>：多等位 SNP 的 genotype 獨立性檢定（.geno.chisq）。</li>
<li><strong><code>--hap-r2-positions</code> / <code>--geno-r2-positions</code></strong>：計算清單中位點與所有位點的 LD（.list.*.ld）。</li>
</ul>
<section id="ld-計算範圍控制" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="ld-計算範圍控制"><span class="header-section-number">5.3.1</span> LD 計算範圍控制</h3>
<ul>
<li><strong><code>--ld-window</code></strong>：最多相隔多少 SNP。</li>
<li><strong><code>--ld-window-bp</code></strong>：最多相隔多少 bp。</li>
<li><strong><code>--ld-window-min</code></strong>：最少要相隔多少 SNP。</li>
<li><strong><code>--ld-window-bp-min</code></strong>：最少要相隔多少 bp。</li>
<li><strong><code>--min-r2</code></strong>：設定 LD r² 門檻，低於此值不輸出。</li>
<li><strong><code>--interchrom-hap-r2</code> / <code>--interchrom-geno-r2</code></strong>：跨染色體 LD。</li>
</ul>
<hr>
</section>
</section>
<section id="transitiontransversion-statistics" class="level2" data-number="5.4">
<h2 data-number="5.4" class="anchored" data-anchor-id="transitiontransversion-statistics"><span class="header-section-number">5.4</span> Transition/Transversion Statistics</h2>
<ul>
<li><strong><code>--TsTv &lt;integer&gt;</code></strong>：依 bin 大小計算 Ts/Tv（.TsTv）。</li>
<li><strong><code>--TsTv-summary</code></strong>：總 Ts/Tv 摘要（.TsTv.summary）。</li>
<li><strong><code>--TsTv-by-count</code></strong>：依 ALT allele count 計算 Ts/Tv（.TsTv.count）。</li>
<li><strong><code>--TsTv-by-qual</code></strong>：依 SNP QUAL 門檻計算 Ts/Tv（.TsTv.qual）。</li>
<li><strong><code>--FILTER-summary</code></strong>：每個 FILTER 類別的 SNP/ Ts/Tv 統計（.FILTER.summary）。</li>
</ul>
<hr>
</section>
<section id="核苷酸多樣性-π" class="level2" data-number="5.5">
<h2 data-number="5.5" class="anchored" data-anchor-id="核苷酸多樣性-π"><span class="header-section-number">5.5</span> 核苷酸多樣性 π</h2>
<ul>
<li><strong><code>--site-pi</code></strong>：每位點的 pi（.sites.pi）。</li>
<li><strong><code>--window-pi &lt;size&gt;</code></strong>：以 window 計算 pi（.windowed.pi）。</li>
<li><strong><code>--window-pi-step &lt;step&gt;</code></strong>：設定 window 移動步長。</li>
</ul>
<hr>
</section>
<section id="fst-statistics族群遺傳分化" class="level2" data-number="5.6">
<h2 data-number="5.6" class="anchored" data-anchor-id="fst-statistics族群遺傳分化"><span class="header-section-number">5.6</span> Fst Statistics（族群遺傳分化）</h2>
<ul>
<li><strong><code>--weir-fst-pop &lt;file&gt;</code></strong>：計算 Weir &amp; Cockerham Fst（.weir.fst）。可多次指定多族群。</li>
<li><strong><code>--fst-window-size</code> / <code>--fst-window-step</code></strong>：以 windows 計算 Fst。</li>
</ul>
<hr>
</section>
<section id="其他分析統計" class="level2" data-number="5.7">
<h2 data-number="5.7" class="anchored" data-anchor-id="其他分析統計"><span class="header-section-number">5.7</span> 其他分析統計</h2>
<ul>
<li><strong><code>--het</code></strong>：輸出個體的 heterozygosity 與 inbreeding F 值（.het）。</li>
<li><strong><code>--hardy</code></strong>：每位點 HWE p-value（.hwe）。</li>
<li><strong><code>--TajimaD &lt;size&gt;</code></strong>：Tajima’s D（.Tajima.D）。</li>
<li><strong><code>--indv-freq-burden</code></strong>：個體中不同頻率變異的負擔量（.ifreqburden）。</li>
<li><strong><code>--LROH</code></strong>：長片段同質（Runs of Homozygosity）（.LROH）。</li>
<li><strong><code>--relatedness / --relatedness2</code></strong>：兩種 relatedness 指標（.relatedness）。</li>
<li><strong><code>--site-quality</code></strong>：每位點 QUAL（.lqual）。</li>
<li><strong><code>--missing-indv</code></strong>：個體層級缺失率（.imiss）。</li>
<li><strong><code>--missing-site</code></strong>：位點層級缺失率（.lmiss）。</li>
<li><strong><code>--SNPdensity &lt;size&gt;</code></strong>：每 bin SNP 數與密度（.snpden）。</li>
<li><strong><code>--kept-sites</code></strong>：保留位點清單（.kept.sites）。</li>
<li><strong><code>--removed-sites</code></strong>：移除位點清單（.removed.sites）。</li>
<li><strong><code>--singletons</code></strong>：偵測 singleton 與 private doubleton（.singletons）。</li>
<li><strong><code>--hist-indel-len</code></strong>：Indel 長度分布（.indel.hist）。</li>
<li><strong><code>--hapcount &lt;BED&gt;</code></strong>：計算各 bin haplotype 數（.hapcount）。</li>
<li><strong><code>--mendel &lt;PED&gt;</code></strong>：以 PED 族譜偵測親子不相容（.mendel）。</li>
</ul>
<hr>
</section>
<section id="output-formatinfo-extraction擷取格式或info欄位置" class="level2" data-number="5.8">
<h2 data-number="5.8" class="anchored" data-anchor-id="output-formatinfo-extraction擷取格式或info欄位置"><span class="header-section-number">5.8</span> Output FORMAT/INFO Extraction（擷取格式或INFO欄位置）</h2>
<ul>
<li><strong><code>--extract-FORMAT-info &lt;ID&gt;</code></strong>：擷取指定 FORMAT 欄位（.FORMAT）。</li>
<li><strong><code>--get-INFO &lt;ID&gt;</code></strong>：擷取指定 INFO 欄位，可重複使用（.INFO）。</li>
</ul>
<hr>
</section>
<section id="output-vcfbcf重新編碼輸出" class="level2" data-number="5.9">
<h2 data-number="5.9" class="anchored" data-anchor-id="output-vcfbcf重新編碼輸出"><span class="header-section-number">5.9</span> Output VCF/BCF（重新編碼輸出）</h2>
<ul>
<li><strong><code>--recode / --recode-bcf</code></strong>：依過濾後結果輸出 VCF 或 BCF（.recode.vcf/.recode.bcf）。</li>
<li><strong><code>--recode-INFO &lt;ID&gt;</code></strong>：保留指定 INFO 欄位。</li>
<li><strong><code>--recode-INFO-all</code></strong>：保留所有 INFO 欄位。</li>
<li><strong><code>--contigs &lt;file&gt;</code></strong>：為 BCF 加入 contig header。</li>
</ul>
<hr>
</section>
<section id="other-format-outputs轉換為其他格式" class="level2" data-number="5.10">
<h2 data-number="5.10" class="anchored" data-anchor-id="other-format-outputs轉換為其他格式"><span class="header-section-number">5.10</span> Other Format Outputs（轉換為其他格式）</h2>
<ul>
<li><strong><code>--012</code></strong>：輸出 genotype matrix（.012/.012.pos/.012.indv）。</li>
<li><strong><code>--IMPUTE</code></strong>：輸出 phased haplotypes（IMPUTE 格式）。</li>
<li><strong><code>--ldhat / --ldhat-geno</code></strong>：輸出 LDhat 格式（需指定 –chr）。</li>
<li><strong><code>--BEAGLE-GL</code> / <code>--BEAGLE-PL</code></strong>：輸出 BEAGLE likelihood 格式。</li>
<li><strong><code>--plink</code> / <code>--plink-tped</code></strong>：輸出 PLINK 格式（PED/MAP 或 TPED/TFAM）。</li>
<li><strong><code>--chrom-map &lt;file&gt;</code></strong>：指定染色體名稱→編號映射表（用於非人類物種）。</li>
</ul>
<hr>
</section>
</section>
<section id="vcf檔案比較" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> VCF檔案比較</h1>
<p>這些選項用於比較兩個 VCF/BCF 檔案之間的差異，包括位點是否一致、樣本是否一致、基因型是否不相符（discordance）、以及 phased 資料的 switch error 等。使用比較功能時，兩個檔案必須：</p>
<ul>
<li>具有相同染色體集合</li>
<li>染色體順序一致</li>
<li>若某檔案多出額外染色體，可先用 <code>--not-chr</code> 過濾後再比較</li>
</ul>
<hr>
<ul>
<li><strong><code>--diff &lt;filename&gt;</code></strong>：比較原始 VCF 與指定的未壓縮 VCF。</li>
<li><strong><code>--gzdiff &lt;filename&gt;</code></strong>：比較原始 VCF 與指定的 <code>.vcf.gz</code> 檔。</li>
<li><strong><code>--diff-bcf &lt;filename&gt;</code></strong>：比較原始 VCF 與指定的 BCF 檔。</li>
</ul>
<blockquote class="blockquote">
<p>` 以上選項都必須搭配至少一個 “diff option”（如下方） 才會執行比較。</p>
</blockquote>
<ul>
<li><strong><code>--diff-site</code></strong>：比較位點是否存在於兩檔案中（共同 / 僅在 A / 僅在 B）。 → 輸出：<code>.diff.sites_in_files</code></li>
<li><strong><code>--diff-site-discordance</code></strong>：逐位點計算基因型不一致（discordance）。 → 輸出：<code>.diff.sites</code></li>
<li><strong><code>--diff-indv</code></strong>：比較兩檔案的樣本集合（共同 / 僅在 A / 僅在 B）。 → 輸出：<code>.diff.indv_in_files</code></li>
<li><strong><code>--diff-indv-discordance</code></strong>：比較每個樣本在兩檔案中的基因型不一致程度。 → 輸出：<code>.diff.indv</code></li>
<li><strong><code>--diff-indv-map &lt;filename&gt;</code></strong>：提供樣本 ID 對照表（file1_ID ↔︎ file2_ID），用於樣本名稱不同但實為同一個人的情況。 檔案格式：<code>sample_in_file1&lt;TAB&gt;</code>sample_in_file2`</li>
<li><strong><code>--diff-discordance-matrix</code></strong>：計算基因型不一致矩陣（僅適用 bi-allelic 且兩檔案等位基因皆相符）。 → 輸出：<code>.diff.discordance.matrix</code></li>
<li><strong><code>--diff-switch-error</code></strong>：計算 phased genotypes 的 switch error（相鄰位點的相位切換錯誤）。 → 輸出：<code>.diff.switch</code></li>
</ul>
<hr>
</section>
<section id="man-vcftools" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> man vcftools</h1>
<p>可以輸入 <code>man vcftools</code> 詳細查看指令資訊</p>
<div class="cell">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb4"><pre class="sourceCode bash code-with-copy"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">man</span> vcftools <span class="kw">|</span> <span class="fu">head</span> <span class="at">-n</span> 30</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>vcftools(1)                                                                                       vcftools man page                                                                                       vcftools(1)

NAME
       vcftools - Utilities for the variant call format (VCF) and binary variant call format (BCF)

SYNOPSIS
       vcftools [ --vcf FILE | --gzvcf FILE | --bcf FILE] [ --out OUTPUT PREFIX ] [ FILTERING OPTIONS ]  [ OUTPUT OPTIONS ]

DESCRIPTION
       vcftools  is a suite of functions for use on genetic variation data in the form of VCF and BCF files. The tools provided will be used mainly to summarize data, run calculations on data, filter out data, and
       convert data into other useful file formats.

EXAMPLES
       Output allele frequency for all sites in the input vcf file from chromosome 1
         vcftools --gzvcf input_file.vcf.gz --freq --chr 1 --out chr1_analysis

       Output a new vcf file from the input vcf file that removes any indel sites
         vcftools --vcf input_file.vcf --remove-indels --recode --recode-INFO-all --out SNPs_only

       Output file comparing the sites in two vcf files
         vcftools --gzvcf input_file1.vcf.gz --gzdiff input_file2.vcf.gz --diff-site --out in1_v_in2

       Output a new vcf file to standard out without any sites that have a filter tag, then compress it with gzip
         vcftools --gzvcf input_file.vcf.gz --remove-filtered-all --recode --stdout | gzip -c &gt; output_PASS_only.vcf.gz

       Output a Hardy-Weinberg p-value for every site in the bcf file that does not have any missing genotypes
         vcftools --bcf input_file.bcf --hardy --max-missing 1.0 --out output_noMissing

       Output nucleotide diversity at a list of positions
         zcat input_file.vcf.gz | vcftools --vcf - --site-pi --positions SNP_list.txt --out nucleotide_diversity</code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>